---
title: HTTP 与 HTTPS
categories:
- Internet
- HTTP
---
# HTTP 与 HTTPS

### HTTP与HTTPS的区别

- HTTPS协议需要到CA申请证书,一般免费证书较少,因而需要一定费用
- HTTP是超文本传输协议,信息是明文传输,HTTPS则是具有安全性的SSL加密传输协议
- HTTP和HTTPS使用的是完全不同的连接方式,用的端口也不一样,前者是80,后者是443
- HTTP 页面响应速度比 HTTPS 快,主要是因为 HTTP 使用 TCP 三次握手建立连接,客户端和服务器需要交换 3 个包,而 HTTPS除了 TCP 的三个包,还要加上 SSL握手需要的 9 个包,所以一共是 12 个包

### HTTPS的工作原理

1. **传送证书**:Web服务器收到客户端请求后,会将网站的证书信息(证书中包含公钥)传送一份给客户端,这个证书其实就是公钥,只是包含了很多信息,如证书的颁发机构,过期时间等等
2. **客户端解析证书**
    - 这部分工作是有客户端的TLS来完成的,首先会验证公钥是否有效,比如颁发机构,过期时间等等,如果发现异常,则会弹出一个警告框,提示证书存在问题
    - 如果证书没有问题,那么就生成一个随机值,然后用证书对该随机值进行加密,就好像上面说的,把随机值用锁头锁起来,这样除非有钥匙,不然看不到被锁住的内容
3. **传送加密信息**:这部分传送的是用证书加密后的随机值,目的就是让服务端得到这个随机值,以后客户端和服务端的通信就可以通过这个随机值来进行加密解密了
4. **服务端解密信息**:服务端用私钥解密后,得到了客户端传过来的随机值(会话密钥),然后把内容通过该值进行对称加密,所谓对称加密就是,将信息和私钥通过某种算法混合在一起,这样除非知道私钥,不然无法获取内容,而正好客户端和服务端都知道这个私钥,所以只要加密算法够彪悍,私钥够复杂,数据就够安全
5. **传输加密后的信息**:这部分信息是服务段用会话密钥加密后的信息,可以在客户端被还原
6. **客户端解密信息**:客户端用之前生成的会话密钥解密服务段传过来的信息,于是获取了解密后的内容,整个过程第三方即使监听到了数据,也束手无策

![](https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/20210707095707.gif)

> **对称加密与非对称加密**
>
> - 对称加密:指的就是加,解密使用的同是一串密钥,所以被称做对称加密,对称加密只有一个密钥作为私钥,常见的对称加密算法:DES,AES等
> - 非对称加密:指的是加,解密使用不同的密钥,一把作为公开的公钥,另一把作为私钥,公钥加密的信息,只有私钥才能解密,反之,私钥加密的信息,只有公钥才能解密
>

### HTTPS的通信步骤

<img src="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/20210707134233.png" alt="2020042800445749" style="zoom:50%;" />

**SSL四次握手**

1. 一次握手

    - 步骤 1:客户端通过发送 Client Hello 报文开始 SSL通信,报文中包含客户端支持的 SSL的指定版本,加密组件(Cipher Suite)列表(所使用的加密算法及密钥长度等)

2. 二次握手

    - 步骤 2:服务器可进行 SSL通信时,会以 Server Hello 报文作为应答,和客户端一样,在报文中包含 SSL版本以及加密组件,服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的

    - 步骤 3:之后服务器发送 Certificate 报文,报文中包含公开密钥证书

    - 步骤 4:最后服务器发送 Server Hello Done 报文通知客户端,最初阶段的 SSL握手协商部分结束

3. 三次握手

    - 步骤 5:客户端以 Client Key Exchange 报文作为回应,报文中包含通信加密中使用的一种被称为 Pre-mastersecret 的随机密码串,该报文已用步骤 3 中的公开密钥进行加密
    - 步骤 6:接着客户端继续发送 Change Cipher Spec 报文,该报文会提示服务器,在此报文之后的通信会采用Pre-master secret 密钥加密
    - 步骤 7:客户端发送 Finished 报文,该报文包含连接至今全部报文的整体校验值,这次握手协商是否能够成功,要以服务器是否能够正确解密该报文作为判定标准

4. 四次握手

    - 步骤 8:服务器同样发送 Change Cipher Spec 报文
    - 步骤 9:服务器同样发送 Finished 报文

5. 总的来说,SSL会话的建立完成了以下几个工作:交换协议版本号,选择一个通信双方都支持的加密方式,对两端实现身份验证,密钥交换

**SSL连接完成后,建立TCP连接,发送HTTP请求**

- 步骤 10:服务器和客户端的 Finished 报文交换完毕之后,SSL连接就算建立完成,通信会受到 SSL的保护,从此处开始进行应用层协议的通信,即发送 HTTP 请求
- 步骤 11:应用层协议通信,即发送 HTTP 响应

**通信完成后断开连接**

- 步骤 12:最后由客户端断开连接,断开连接时,发送 close_notify 报文,上图做了一些省略,这步之后再发送 TCP FIN 报文来关闭与 TCP的通信