---
title: Java 线程
categories:
- Software
- Backend
- Java
- JavaSE
- 多线程
---
# Java 线程

## 多进程与多线程

### 多进程

大多数操作系统允许创建多个进程,当一个程序因等待网络访问或用户输入而被堵塞时,另一个程序还可以运行,这样就增加了资源利用率,但是进程切换要占用较多的处理器时间和内存资源,也就是多进程开销大,而且进程间的通信也不太方便,大多数操作系统不允许进程访问其他进程的内存空间

### 多线程

多线程则指的是在单个程序中可以同时运行多个不同的线程,执行不同的任务,因为线程只能在单个进程的作用域内活动,所以创建线程比创建进程要廉价得多,同一类线程共享代码和数据空间,每个线程有独立的运行栈,线程切换的开销小,因此多线程编程在现代软件设计中被大量采用

## 线程的状态

- Java语言使用Thread类及其子类来表示线程,新建的线程在它的一个完整的生命周期中通常要经历如下5种状态:
    - 新建状态
    - 就绪状态
    - 运行状态
    - 阻塞状态
    - 终止状态

![Component-Page-1](https://cdn.jsdelivr.net/gh/LuShan123888/Files@master/Pictures/2020-12-10-2020-12-10-2020-11-07-Component-Page-1.svg)

- 首先,一个线程通过对象创建方式建立,线程对象通过调用`start()`方法进入到`就绪状态`,一个处于`就绪状态`下的线程将有机会等待调度程序安排CPU时间片进入到`运行状态`
- 在"运行状态”的线程根据情况有如下3种可能的走向:
    - 时间片执行时间用完它将重新回到`就绪状态`,等待新的调度运行机会
    - 线程的`run()`方法代码执行完毕将进入到`终止状态`
    - 线程可能因为某些事件的发生或者等待某个资源而进入到`阻塞状态`,阻塞条件解除后线程将进入`就绪状态`

## 线程调度与优先级

- Java提供一个线程调度器来负责线程调度,Java采用抢占式调度策略,在程序中可以给每个程序分配一个线程优先级,优先级高的线程优先获得调度,对于优先级相同的线程,根据在等待队列的排列顺序按"先到先服务”原则调度,每个线程安排一个时间片,执行完时间片将轮到下一线程
- 下面几种情况中,当前线程会放弃CPU:
    - 当前时间片用完
    - 线程在执行时调用了`yield()`或`sleep()`方法主动放弃
    - 进行I/O访问,等待用户输入,导致线程阻塞,或者为等待一个条件变量,线程调用`wait()`方法
    - 有高优先级的线程参与调度
- 线程的优先级用数字来表示,范围从1~10,主线程的默认优先级为5,其他线程的优先级与创建它的父线程的优先级相同,为了方便,Thread类提供了如下几个常量来表示优先级:
    - `Thread.MIN_PRIORITY=1`
    - `Thread.MAX_PRIORITY=10`
    - `Thread.NORM_PRIORITY=5`

