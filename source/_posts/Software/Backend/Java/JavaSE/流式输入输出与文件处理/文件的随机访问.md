---
title: Java 文件的随机访问
categories:
- Software
- Backend
- Java
- JavaSE
- 流式输入输出与文件处理
---
# Java 文件的随机访问

前面介绍的文件访问均是顺序访问,对同一文件操作只限于读操作或者写数据,不能同时进行,而且只能按记录顺序逐个读或逐个写,`RandomAccessFile`类提供了对流进行随机读写的能力,该类实现了`DataInput`和`DataOutput`接口,因此,可使用两接口中定义的所有方法实现数据的读写操作,为支持流的随机读写访问,该类该添加定哦以来如下方法

- `long getFilePointer()`:返回当前指针
- `void seek(long pos)`:将文件指针定位到一个绝对地址,地址是相对于文件头的偏移量,地址0表示文件的开头
- `long length()`:返回文件的长度
- `setLength(long new Length)`:设置文件的长度,在删除记录时可以采用,如果文件的长度大于设定值,则按设定值设定新长度,删除文件多余部分,如果文件长度小于设定值,则对文扩展,扩充部分内容不定

`RamdomAccessFile`类的构造方法如下:

- `public RandomAccessFile(String name,String mode)`
- `public RandomAccessFile(File file,String mode)`

其中,第1个参数指定要打开的文件,第2个参数决定了访问文件的权限,其值可以为‘r’或‘rw’,‘r’表示只读,‘rw’表示可进行读和写两种访问,创建`RandomAccessFile`对象时,如果文件不存在,则打开文件,如果不存在将创建一个文件

**[例13-8]**应用系统用户访问统计

```java
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.RandomAccessFile;
import java.util.RandomAccess;

public class 应用系统用户访问统计 {
    public static void main(String[] args) {
        long count;//用来表示访问计数值
        try {
            RandomAccessFile fio;
            fio = new RandomAccessFile("src/Study/流式输入输出与文件处理/文件的随机访问/count.txt", "rw");
            if (fio.length() == 0)//新建文件的长度为0
                count = 1L;//第一次访问
            else {
                fio.seek(0);//定位到文件首字节
                count = fio.readLong();//读原来保存的计数值
                count = count + 1L;//计数增1
                System.out.println(count);
            }
            fio.seek(0);
            fio.writeLong(count);//写入新计数值
            fio.close();
        } catch (FileNotFoundException e) {
        } catch (IOException e) {
        }
    }
}
```

**说明**:利用随机文件存储访问计数值,将计数值写入文件的开始位置,注意,进行读写操作前要关注文件指针的定位
