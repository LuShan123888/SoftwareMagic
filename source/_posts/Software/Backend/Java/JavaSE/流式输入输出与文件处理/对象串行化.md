---
title: Java 对象串行化
categories:
- Software
- Backend
- Java
- JavaSE
- 流式输入输出与文件处理
---
# Java 对象串行化

- 对象输入流`ObjectInputStream`和对象输出流`ObjectOutputStream`将Java流系统扩充到能输入/输出对象,他们提供的`writeObject()`和`readObject()`方法实现了对象的串行化(Serialized)和反串行化(Deserialized)
- 要将对象写入到输出流实际上要建立对象和字节流之间的一种映射关系,这里利用文件保存对象信息或者利用网络实现对象的传递只是实现一种轻量级对象持久性,进一步,借助对象串行化技术可以建立对象和数据库之间的映射,从而将对象中需要持久保存的信息写入到或数据库,这是实现重量级对象持久性的常用方法
- 值得注意的是,为了实现用户自定义的串行化,相应的类必须实现`Serializable`接口,否则不能以对象形式正确写入文件,`Serializable`接口中没有定义任何方法,以下实例介绍的`Date`和`String`之所以能写入文件,实际上均实现`Serializable`接口

**[例13-9]**系统对象的串行化处理

**将系统对象写入文件**

```java
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.util.Date;

public class 将系统对象写入文件 {
  public static void main(String[] args) {
    try {
      ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream("src/Study/流式输入输出与文件处理/对象串行化/Study/流式输入输出与文件处理/系统对象的串行化处理/storedata.dat"));
      // 用对象输出流的writeObject()方法分别写入了日期和字符串对象到文件中
      out.writeObject(new Date());//写入日期对象
      out.writeObject("hello world");//写入字符串对象
      System.out.println("写入完毕");
    }catch (IOException e){}
  }
}
```

**读取文件中的对象并显示出来**

```java
import java.io.*;
import java.util.Date;

public class 读取文件中的对象并显示出来 {
  public static void main(String[] args) {
    try {
      ObjectInputStream in = new ObjectInputStream(new FileInputStream("src/Study/流式输入输出与文件处理/对象串行化/Study/流式输入输出与文件处理/系统对象的串行化处理/storedata.dat"));
      //调用对象输入流的readObject()方法读文件汇总存储的对象,如果输入源数据不符合对象规范将产生ClassNotFoundException异常
      Date current =(Date)in.readObject();
      System.out.println("日期:"+current);
      String str = (String)in.readObject();
      System.out.println("字符串:"+str);
    }catch (IOException e){
    }catch (ClassNotFoundException e){

    }
  }
}
```

**[例13-10]**利用对象串行化将各种图形元素以对象形式存储,从而实现图形的保存

- 为简单起见,这里以直线和圆为例,创建Line和Circle两个类分别表示直线和圆,为了能方便地访问各种图形元素,定义一个抽象父类Graph,其中提供了一个`draw()`方法用来绘制相应的图形

**图形对象的串行化设计**

```java
import java.awt.*;
import java.io.Serializable;

abstract class Graph implements Serializable {//抽象类

  public abstract void draw(Graphics g);//定义draw()方法
}

class Line extends Graph {
  int x1, y1;
  int x2, y2;

  public void draw(Graphics g) {//实现直线绘制的draw()方法
    g.drawLine(x1, y1, x2, y2);
  }

  public Line(int x1, int y1, int x2, int y2) {
    this.x1 = x1;
    this.y1 = y1;
    this.x2 = x2;
    this.y2 = y2;
  }
}

class Circle extends Graph {
  int x, y;
  int r;

  public void draw(Graphics g) {//实现圆绘制draw()
    g.drawOval(x, y, r, r);
  }

  public Circle(int x, int y, int r) {
    this.x = x;
    this.y = y;
    this.r = r;
  }
}
```

**测试将图形对象串行化写入文件**

```java
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;

public class 测试将图形对象串行化写入文件 {
    public static void main(String[] args) {
        /*以下程序分别创建一条直线和一个圆写入文件中*/
        Line K1= new Line(60,90,140,90);
        Line K3= new Line(100,50,100,130);
        Circle K2 = new Circle(60,50,80);
        try {
            FileOutputStream fout = new FileOutputStream("src/Study/流式输入输出与文件处理/对象串行化/Study/流式输入输出与文件处理/图形的串行化处理/storeshape.dat");
            ObjectOutputStream out = new ObjectOutputStream(fout);
            out.writeObject(new Integer(3));//保存要写入图形对象的数量
            out.writeObject(K1);//写入直线
            out.writeObject(K2);//写入圆
            out.writeObject(K3);//写入直线
        }catch (IOException e){
            System.out.println(e);
        }
    }
}
```

**从文件读取串行化对象并绘图**

```java
import java.awt.*;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.ObjectInputStream;

class DisplayGraph extends Frame{
  public static void main(String[] args) {
    new DisplayGraph();
  }

  public DisplayGraph(){
    super("读对象文件显示图形");
    setSize(300,300);
    setVisible(true);
    Graphics g = getGraphics();//得到窗体的Graphics对象
    try{
      FileInputStream fin =  new FileInputStream("src/Study/流式输入输出与文件处理/对象串行化/Study/流式输入输出与文件处理/图形的串行化处理/storeshape.dat");
      ObjectInputStream in = new ObjectInputStream(fin);
      // 读出图形对象的数量
      int n=((Integer)in.readObject()).intValue();
      for (int i=1;i<=n;i++){
        Graph me = (Graph)in.readObject();//读取对象
        //根据图形对象的个数循环读出每个图形对象并调用其draw()方法进行绘图
        me.draw(g);
      }
    }catch (IOException e){}
    catch (ClassNotFoundException e){}
  }
}
```

**说明**:为了增加程序的通用性,程序中将要写入文件中的图形对象的数量首先写入到文件的开始处

