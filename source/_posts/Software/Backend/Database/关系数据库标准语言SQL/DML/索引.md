---
title: SQL 索引
categories:
- Software
- Backend
- Database
- 关系数据库标准语言SQL
- DML
---
# SQL 索引

## 索引准则

- 索引不是越多越好
- 不要对经常变动的数据加索引
- 小数据量的表建议不要加索引
- 索引一般应加在查找条件的字段

## 索引的数据结构

- 索引类型
    - hash类型的索引:查询单条快,范围查询慢
    - btree类型的索引:b+树,层数越多,数据量指数级增长(我们就用它,因为innodb默认支持它)
- 不同的存储引擎支持的索引类型也不一样
    - InnoDB 支持事务,支持行级别锁定,支持 B-tree,Full-text 等索引,不支持 Hash 索引;
    - MyISAM 不支持事务,支持表级别锁定,支持 B-tree,Full-text 等索引,不支持 Hash 索引;
    - Memory 不支持事务,支持表级别锁定,支持 B-tree,Hash 等索引,不支持 Full-text 索引;
    - NDB 支持事务,支持行级别锁定,支持 Hash 索引,不支持 B-tree,Full-text 等索引;
    - Archive 不支持事务,支持表级别锁定,不支持 B-tree,Hash,Full-text 等索引;

## 索引的作用

- 提高查询速度
- 确保数据的唯一性
- 可以加速表和表之间的连接 , 实现表与表之间的参照完整性
- 使用分组和排序子句进行数据检索时 , 可以显著减少分组和排序的时间
- 全文检索字段进行搜索优化

## 索引的分类

- 主键索引 (Primary Key)
- 唯一索引 (Unique)
- 常规索引 (Index)
- 全文索引 (FullText)

### 主键索引

- **主键** : 某一个属性组能唯一标识一条记录
- 特点 :
    - 最常见的索引类型
    - 确保数据记录的唯一性
    - 确定特定数据记录在数据库中的位置

### 唯一索引

- **作用** : 避免同一个表中某数据列中的值重复
- 与主键索引的区别
    - 主键索引只能有一个
    - 唯一索引可能有多个

```mysql
CREATE TABLE `Grade`(
  `GradeID` INT(11) AUTO_INCREMENT PRIMARYKEY,
  `GradeName` VARCHAR(32) NOT NULL UNIQUE
   -- 或 UNIQUE KEY `GradeID` (`GradeID`)
)
```

### 常规索引

- **作用** : 快速定位特定数据
- 注意 :
    - index 和 key 关键字都可以设置常规索引
    - 应加在查询找条件的字段
    - 不宜添加太多常规索引,影响数据的插入,删除和修改操作

### 全文索引

- **作用** : 快速定位特定数据
- **注意** :
    - 适合大型数据集
    - MySQL 5.6 以前的版本,只有 MyISAM 存储引擎支持全文索引
    - MySQL 5.6 及以后的版本,MyISAM 和 InnoDB 存储引擎均支持全文索引
    - 只有字段的数据类型为 char,varchar,text 及其系列才可以建全文索引

## 创建索引

- 创建表时

```mysql
CREATE TABLE 表名 (
    字段名1 数据类型 [完整性约束条件...],
    字段名2 数据类型 [完整性约束条件...],
    [UNIQUE | FULLTEXT | SPATIAL ]   INDEX | KEY
    [索引名] (字段名[(长度)] [ASC |DESC])
);
```

- CREATE 在已存在的表上创建索引

```mysql
 CREATE [UNIQUE | FULLTEXT | SPATIAL ] INDEX 索引名
                    ON 表名 (字段名[(长度)] [ASC |DESC]) ;
```

- ALTER TABLE在已存在的表上创建索引

```mysql
       ALTER TABLE 表名 ADD [UNIQUE | FULLTEXT | SPATIAL ] INDEX
                            索引名 (字段名[(长度)] [ASC |DESC]) ;
```

**注意:**

- <表名>是要建索引的基本表的名字,索引可以建立在该表的一列或多列上,各列名之间用逗号分隔,每个<列名>后面还可以用<次序>指定索引值的排列次序,可选ASC(升序)或DESC(降序),默认值为ASC
- UNIQUE表明此索引的每一个索引值只对应唯一的数据记录
- CLUSTER表示要建立的索引是聚簇索引

**[例3.13]**为学生-课程数据库中的Student,Course和SC三个表建立索引,其中 Student表按学号升序建唯一索引

```mysql
CREATE UNIQUE INDEX Stusno ON Student(Sno);
CREATE UNIQUE INDEX Course ON Course(Cno);
CREATE UNIQUE INDEX SCno ON SC(Sno ASC,Cno DESC);
```

## 删除索引

- 删除索引:

```mysql
DROP INDEX 索引名 ON 表名字;
```

- 删除主键索引:

```mysql
ALTER TABLE 表名 DROP PRIMARY KEY;
```



## 查看索引

```mysql
SHOW INDEX FROM student;
```

## 修改索引

```sql
ALTER INDEX <旧索引名> RENAME TO<新索引名>;
```

**[例3.14]**将SC表的SCno索引名改为SCSno

```sql
ALTER INDEX SCno RENAME TO SCSno;
```

## 分析SQL语句执行性能

```
 EXPLAIN SELECT * FROM student WHERE studentno='1000';
```

## 使用全文索引

- 全文搜索通过 `MATCH()` 函数完成
- 搜索字符串作为 `against()` 的参数被给定,搜索以忽略字母大小写的方式执行,对于表中的每个记录行,`MATCH()` 返回一个相关性值,即,在搜索字符串与记录行在 `MATCH()` 列表中指定的列的文本之间的相似性尺度

```mysql
EXPLAIN SELECT *FROM student WHERE MATCH(studentname) AGAINST('love');
```