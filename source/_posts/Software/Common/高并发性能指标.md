---
title: 高并发性能指标
categories:
- Software
- Common
---
# 高并发性能指标

## QPS

QPS：Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。

互联网中，作为域名系统服务器的机器的性能经常用每秒查询率来衡量。

## TPS

TPS：是TransactionsPerSecond的缩写，也就是事务数/秒。它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。

**QPS与TPS的区别**：QPS基本类似于TPS，但是不同的是，对于一个页面的一次访问，形成一个TPS；但一次页面请求，可能产生多次对服务器的请求，服务器对这些请求，就可计入QPS之中。如，访问一个页面会请求服务器2次，一次访问，产生一个“T”，产生2个“Q”。

## RT

响应时间：执行一个请求从开始到最后收到响应数据所花费的总体时间，即从客户端发起请求到收到服务器响应结果的时间。

响应时间RT(Response-time)，是一个系统最重要的指标之一，它的数值大小直接反应了系统的快慢。

## 并发数

并发数是指系统同时能处理的请求数量，这个也是反应了系统的负载能力。

## 吞吐量

系统的吞吐量（承压能力）与request对CPU的消耗、外部接口、IO等等紧密关联。单个request 对CPU消耗越高，外部系统接口、IO速度越慢，系统吞吐能力越低，反之越高。

系统吞吐量几个重要参数：QPS（TPS）、并发数、响应时间。

1. QPS（TPS）：（Query Per Second）每秒钟request/事务数量。
2. 并发数： 系统同时处理的request/事务数。
3. 响应时间： 一般取平均响应时间。

**QPS（TPS）= 并发数/平均响应时间**

按二八定律来看，如果每天 80% 的访问集中在 20% 的时间里，这 20% 时间就叫做峰值时间。

- （总PV数 * 80% ) / （每天秒数 * 20% ) = 峰值时间每秒请求数（QPS)
- 服务器数量 = 峰值时间每秒QPS / 单台机器的QPS 

## 最佳线程数

**单线程QPS公式：QPS=1000ms/RT** 

对同一个系统而言，支持的线程数越多，QPS越高。假设一个RT是80ms，则可以很容易的计算出QPS,QPS = 1000/80 = 12.5 

多线程场景，如果把服务端的线程数提升到2，那么整个系统的QPS则为 2*（1000/80） = 25，可见QPS随着线程的增加而线性增长，那QPS上不去就加线程呗，听起来很有道理，但是往往现实并非如此。

**QPS和RT的真实关系**

理想的QPS、RT关系如下：

![一文搞懂高并发性能指标：QPS、TPS、RT、吞吐量](https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/6b411ccdde024a14a9cd517796c2113b.png)



实际的QPS、RT关系如下，

![一文搞懂高并发性能指标：QPS、TPS、RT、吞吐量](https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/5d9a413974304b2b81ef1d5fdbec41b0.png)

**最佳线程数量** 

最佳线程数量是指刚好消耗完服务器的瓶颈资源的临界线程数。

最佳线程数量=(（线程等待时间+线程CPU时间）/线程CPU时间）* CPU数量 

**注意**

- 在达到最佳线程数的时候，线程数量继续递增，则QPS不变，而响应时间变长，持续递增线程数量，则QPS开始下降。
- 每个系统都有其最佳线程数量，但是不同状态下，最佳线程数量是会变化的。
- 瓶颈资源可以是CPU，可以是内存，可以是锁资源，IO资源。