---
title: Vue 实例
categories:
- Software
- Frontend
- Vue
---
# Vue 实例

## 使用Base64实现图片的上传与回显

### 创建文件上传接口

- 接口

```java
@PostMapping("/saveOne")
public SysResult saveOne(@RequestBody SysFile sysFile) {
    sysFile.setId(GuidHelper.newGuid());
    sysFile.setCreateTime(new Date());
    int res = sysFileMapper.insertOne(sysFile);
    if (res != 1) {
        return CallResult.error("上传失败");
    }
    FileVO fileVO = new FileVO();
    fileVO.setId(sysFile.getId());
    fileVO.setFileName(sysFile.getFileName());
    return new SysResult(fileVO, "上传成功");
}
```

- 实体类,FileData用于存储base64数据

```java
import com.fasterxml.jackson.annotation.JsonFormat;
import com.fasterxml.jackson.annotation.JsonProperty;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.format.annotation.DateTimeFormat;

import java.util.Date;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class SysFile {
    /**Id*/
    @JsonProperty("Id")
    private String Id;

    /**文件名*/
    @JsonProperty("FileName")
    private String FileName;

    /**文件大小*/
    @JsonProperty("FileSize")
    private Integer FileSize;

    /**文件类型*/
    @JsonProperty("FileType")
    private String FileType;

    /**文件数据*/
    @JsonProperty("FileData")
    private String FileData;

    /**创建时间*/
    /* 将表单提交的日期格式改为数据库中的格式*/
    @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss",timezone = "GMT+8")
    @JsonProperty("CreateTime")
    private Date CreateTime;
}
```

### element自定义文件上传接口

```html
<el-upload
           ref="upload"
           class="upload-demo"
           action
           :on-remove="handleRemove"
           :http-request="uploadFile"
           :multiple="true"
           :file-list="fileList"
           >
    <el-button
               slot="trigger"
               size="small"
               type="primary"
               >选取文件</el-button>
</el-upload>
```

- 设置action为空,调用http-request自定义上传接口覆盖默认上传方式

```javascript
handleRemove(file) {
    let Id = file.Id;
    if (Id) {
        this.fileList.forEach((e, index) => {
            if (e.Id == Id) {
                this.fileList.splice(index, 1);
                this.$message.error("删除成功");
            }
        });
    }
    this.$emit("fileChange", this.fileList);
},
    uploadFile(data) {
        let fileJson = {};
        this.getFile(data.file)
            .then((data) => {
            fileJson = data;
        })
            .then(() => {
            this.$http.post("/copmapi/sysfile/saveOne", fileJson).then((res) => {
                if (res && res.Code === 0) {
                    // 响应处理
                    this.$message.success(res ? res.Message : "保存成功");
                    let file = res.Data;
                    this.fileList.push({ Id: file.id, name: file.fileName, url: "" });
                } else {
                    this.$message.error(
                        res ? res.Message : "服务器请求超时,请稍后再试,"
                    );
                }
            });
        });
    },
```

### Base64转换

```javascript
getFile(file) {
    return new Promise((resolve, reject) => {
        let reader = new FileReader();
        reader.readAsDataURL(file);
        let fileJson = {}
        reader.onload = () => {
            let base64Str = reader.result;
            let type;
            let arr = file.name.split(".");
            type = arr[arr.length - 1];
            fileJson["FileName"] = file.name
            fileJson["FileData"] = base64Str
            fileJson["FileSize"] = file.size
            fileJson["FileType"] = type
        };
        reader.onerror = function (error) {
            reject(error);
        };
        reader.onloadend = function () {
            resolve(fileJson);
        };
    })
}
```

### 测试

- 上传成功,通过ID查出文件表中的FileData就可以回显了

![在这里插入图片描述](https://cdn.jsdelivr.net/gh/LuShan123888/Files@master/Pictures/2020-12-10-2020-11-27-20201118161439441-20201127195628893.png)