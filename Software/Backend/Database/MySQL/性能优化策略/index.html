

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/logo.png">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Cian">
  <meta name="keywords" content="software computer programmer otes Cloud personal">
  <meta name="description" content="MySQL 性能优化策略   优化表的数据类型,选择合适的数据类型:  原则:在创建表的时候,为了获得更好的性能,我们可以将表中字段的宽度设得尽可能小  在定义邮政编码这个字段时,如果将其设置为 CHAR(255),显然给数据库增加了不必要的空间,甚至使用VARCHAR 这种类型也是多余的,因为 CHAR(6) 就可以很好的完成任务了 同样的,如果可以的话,我们应该使用 MEDIUMINT 而不是">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL 性能优化策略">
<meta property="og:url" content="https://softwaremagic.lushan.tech/Software/Backend/Database/MySQL/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5/">
<meta property="og:site_name" content="SoftwareMagic">
<meta property="og:description" content="MySQL 性能优化策略   优化表的数据类型,选择合适的数据类型:  原则:在创建表的时候,为了获得更好的性能,我们可以将表中字段的宽度设得尽可能小  在定义邮政编码这个字段时,如果将其设置为 CHAR(255),显然给数据库增加了不必要的空间,甚至使用VARCHAR 这种类型也是多余的,因为 CHAR(6) 就可以很好的完成任务了 同样的,如果可以的话,我们应该使用 MEDIUMINT 而不是">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-12-31T13:55:59.000Z">
<meta property="article:modified_time" content="2021-12-31T13:55:59.000Z">
<meta property="article:author" content="Cian">
<meta property="article:tag" content="software computer programmer otes Cloud personal">
<meta name="twitter:card" content="summary_large_image">
  
  <title>MySQL 性能优化策略 - SoftwareMagic</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"softwaremagic.lushan.tech","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/images/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/local-search.xml"};
  </script>
  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/utils.js" ></script>
  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 50vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>SoftwareMagic</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/background.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MySQL 性能优化策略">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-12-31 21:55" pubdate>
        2021年12月31日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      9 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL 性能优化策略</h1>
            
            <div class="markdown-body">
              <h1>MySQL 性能优化策略</h1>
<ol>
<li>
<p>优化表的数据类型,选择合适的数据类型:</p>
<ul>
<li><strong>原则</strong>:在创建表的时候,为了获得更好的性能,我们可以将表中字段的宽度设得尽可能小
<ul>
<li>在定义邮政编码这个字段时,如果将其设置为 CHAR(255),显然给数据库增加了不必要的空间,甚至使用VARCHAR 这种类型也是多余的,因为 CHAR(6) 就可以很好的完成任务了</li>
<li>同样的,如果可以的话,我们应该使用 MEDIUMINT 而不是 BIGIN 来定义整型字段,应该尽量把字段设置为 NOT NULL,这样在将来执行查询的时候,数据库不用去比较 NULL 值</li>
<li>对于某些文本字段,例如&quot;省份”或者&quot;性别”,我们可以将它们定义为 ENUM 类型,因为在 MySQL 中,ENUM 类型被当作数值型数据来处理,而数值型数据被处理起来的速度要比文本类型快得多,这样,我们又可以提高数据库的性能</li>
</ul>
</li>
</ul>
</li>
<li>
<p>最好不要使用返回所有,用具体的字段列表代替<code>*</code>,不要返回用不到的任何字段</p>
</li>
<li>
<p>对查询进行优化,应尽量避免全表扫描,首先应考虑在 WHERE 及 ORDER BY 涉及的列上建立索引</p>
</li>
<li>
<p>避免索引失效</p>
</li>
<li>
<p>使用反范式表避免联表查询效率低的问题</p>
</li>
<li>
<p>使用表的别名(Alias):当在 SQL 语句中连接多个表时,请使用表的别名并把别名前缀于每个 Column 上,这样一来,就可以减少解析的时间并减少那些由 Column 歧义引起的语法错误</p>
</li>
<li>
<p>一些 SQL 查询语句应加上 nolock,读. 写是会相互阻塞的,为了提高并发性能,对于一些查询,可以加上 nolock,这样读的时候可以允许写,但缺点是可能读到未提交的脏数据,使用 nolock 有3条原则:</p>
<ul>
<li>查询的结果用于<strong>插,删,改</strong>的不能加 nolock</li>
</ul>
<ol start="2">
<li>查询的表属于频繁发生页分裂的,慎用 nolock</li>
</ol>
<ul>
<li>使用临时表一样可以保存<strong>数据前影</strong>,起到类似 Oracle 的 undo 表空间的功能,能采用临时表提高并发性能的,不要用 nolock</li>
</ul>
</li>
<li>
<p>常见的简化规则如下:不要有超过 5 个以上的表连接(JOIN),考虑使用临时表或表变量存放中间结果,少用子查询,视图嵌套不要过深,一般视图嵌套不要超过 2 个为宜</p>
</li>
<li>
<p>用 OR 的字句可以分解成多个查询,并且通过 UNION 连接多个查询,他们的速度只同是否使用索引有关,如果查询需要用到联合索引,用 UNION all 执行的效率更高,多个 OR 的字句没有用到索引,改写成 UNION 的形式再试图与索引匹配,一个关键的问题是否用到索引</p>
</li>
<li>
<p>在IN后面值的列表中,将出现最频繁的值放在最前面,出现得最少的放在最后面,减少判断的次数</p>
</li>
<li>
<p>当服务器的内存够多时,配制线程数量 = 最大连接数 + 5,这样能发挥最大的效率,否则使用配制线程数量&lt; 最大连接数,启用 SQL SERVER 的线程池来解决,如果还是数量 = 最大连接数 + 5,严重的损害服务器的性能</p>
</li>
<li>
<p>尽量使用 EXISTS 代替<code>select count(1)</code>来判断是否存在记录,count 函数只有在统计表中所有行数时使用,而且<code>count(1)</code>比<code>count(*)</code>更有效率</p>
</li>
<li>
<p>当有一批处理的插入或更新时,用批量插入或批量更新,不要一条条记录的去更新</p>
</li>
<li>
<p>在所有的存储过程中,能够用 SQL 语句的,不要用循环去实现,例如:列出上个月的每一天,用<code>connect by</code>去递归查询,不用循环从上个月第一天到最后一天</p>
</li>
<li>
<p>选择最有效率的表名顺序(只在基于规则的优化器中有效)</p>
<ul>
<li>Oracle 的解析器按照从右到左的顺序处理 FROM 子句中的表名,FROM 子句中写在最后的表(基础表 driving table)将被最先处理,在 FROM 子句中包含多个表的情况下,你必须选择记录条数最少的表作为基础表</li>
<li>如果有 3 个以上的表连接查询,那就需要选择交叉表(intersection table)作为基础表,交叉表是指那个被其他表所引用的表</li>
</ul>
</li>
<li>
<p>提高 GROUP BY 语句的效率,可以通过将不需要的记录在 GROUP BY 之前过滤掉,下面两个查询返回相同结果,但第二个明显就快了许多</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> JOB, <span class="hljs-built_in">AVG</span>(SAL) <span class="hljs-keyword">FROM</span> EMP <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> JOB <span class="hljs-keyword">HAVING</span> JOB <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;PRESIDENT&#x27;</span> <span class="hljs-keyword">OR</span> JOB <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;MANAGER&#x27;</span>;<br><br><span class="hljs-keyword">SELECT</span> JOB, <span class="hljs-built_in">AVG</span>(SAL) <span class="hljs-keyword">FROM</span> EMPWHERE JOB <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;PRESIDENT&#x27;</span> <span class="hljs-keyword">OR</span> JOB <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;MANAGER&#x27;</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> JOB;<br></code></pre></td></tr></table></figure>
<ol start="16">
<li>SQL 语句用大写,因为 Oracle 总是先解析 SQL 语句,把小写的字母转换成大写的再执行</li>
<li>避免死锁,在你的存储过程和触发器中访问同一个表时总是以相同的顺序,事务应尽可能地缩短,在一个事务中应尽可能减少涉及到的数据量,永远不要在事务中等待用户输入</li>
<li>最好不要使用触发器:
<ul>
<li>触发一个触发器,执行一个触发器事件本身就是一个耗费资源的过程</li>
<li>如果能够使用约束实现的,尽量不要使用触发器</li>
<li>不要为不同的触发事件(Insert. Update 和 Delete)使用相同的触发器</li>
<li>不要在触发器中使用事务型代码</li>
</ul>
</li>
<li>使用慢查询日志去发现慢查询,使用执行计划去判断查询是否正常运行,总是去测试你的查询看看是否他们运行在最佳状态下</li>
<li>有时候 MySQL 会使用错误的索引,对于这种情况使用 USE INDEX,检查使用 SQL_MODE=STRICT 的问题,对于记录数小于5的索引字段,在 UNION 的时候使用LIMIT不是用OR</li>
<li>为了避免在更新前 SELECT,使用 INSERT ON DUPLICATE KEY 或者 INSERT IGNORE,不要用 UPDATE 去实现,不要使用 MAX,使用索引字段和 ORDER BY子句 LIMIT,实际上可以减缓查询在某些情况下,有节制地使用,在 WHERE 子句中使用 UNION 代替子查询,在重新启动的 MySQL,记得来温暖你的数据库,以确保数据在内存和查询速度快,考虑持久连接,而不是多个连接,以减少开销</li>
<li>基准查询,包括使用服务器上的负载,有时一个简单的查询可以影响其他查询,当负载增加在服务器上,使用 SHOW PROCESSLIST 查看慢的和有问题的查询,在开发环境中产生的镜像数据中测试的所有可疑的查询</li>
<li>查询缓冲并不自动处理空格,因此,在写 SQL 语句时,应尽量减少空格的使用,尤其是在 SQL 首和尾的空格(因为查询缓冲并不自动截取首尾空格)</li>
<li>MySQL 查询可以启用高速查询缓存,这是提高数据库性能的有效MySQL优化方法之一,当同一个查询被执行多次时,从缓存中提取数据和直接从数据库中返回数据快很多</li>
<li>EXPLAIN SELECT 查询用来跟踪查看效果:使用 EXPLAIN 关键字可以让你知道 MySQL 是如何处理你的 SQL 语句的,这可以帮你分析你的查询语句或是表结构的性能瓶颈,EXPLAIN 的查询结果还会告诉你你的索引主键被如何利用的,你的数据表是如何被搜索和排序的</li>
<li>当只要一行数据时使用 LIMIT 1
<ul>
<li>当你查询表的有些时候,你已经知道结果只会有一条结果,但因为你可能需要去fetch游标,或是你也许会去检查返回的记录数</li>
<li>在这种情况下,加上 LIMIT 1 可以增加性能,这样一来,MySQL 数据库引擎会在找到一条数据后停止搜索,而不是继续往后查找下一条符合记录的数据</li>
</ul>
</li>
<li>应尽可能的避免更新 clustered 索引数据列,因为 clustered 索引数据列的顺序就是表记录的物理存储顺序,一旦该列值改变将导致整个表记录的顺序的调整,会耗费相当大的资源,若应用系统需要频繁更新 clustered 索引数据列,那么需要考虑是否应将该索引建为 clustered 索引</li>
</ol>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Software/">Software</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/Backend/">Backend</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/Backend/Database/">Database</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/Backend/Database/MySQL/">MySQL</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Software/Backend/Distributed/Dubbo/%E5%90%AF%E5%8A%A8%E6%97%B6%E6%A3%80%E6%9F%A5/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Dubbo 启动时检查</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/Software/Backend/SpringFramework/Spring/DI/">
                        <span class="hidden-mobile">Spring DI</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                

              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
    
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/events.js" ></script>
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/local-search.js" ></script>



  
    <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>







<!-- 主题的启动项 保持在最底部 -->
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/boot.js" ></script>


</body>
</html>
