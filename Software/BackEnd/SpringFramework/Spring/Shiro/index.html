

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/logo.png">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Cian">
  <meta name="keywords" content="software computer programmer otes Cloud personal">
  <meta name="description" content="Spring 整合 Shiro  Apache Shiro 是一个功能强大,灵活的,开源的安全框架,它可以干净利落地处理身份验证,授权,企业会话管理和加密 Apache Shiro 的首要目标是易于使用和理解,安全通常很复杂,甚至让人感到很痛苦,但是 Shiro 却不是这样子的,一个好的安全框架应该屏蔽复杂性,向外暴露简单,直观的 API,来简化开发人员实现应用程序安全所花费的时间和精力 Shir">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring 整合 Shiro">
<meta property="og:url" content="https://softwaremagic.lushan.tech/Software/BackEnd/SpringFramework/Spring/Shiro/">
<meta property="og:site_name" content="SoftwareMagic">
<meta property="og:description" content="Spring 整合 Shiro  Apache Shiro 是一个功能强大,灵活的,开源的安全框架,它可以干净利落地处理身份验证,授权,企业会话管理和加密 Apache Shiro 的首要目标是易于使用和理解,安全通常很复杂,甚至让人感到很痛苦,但是 Shiro 却不是这样子的,一个好的安全框架应该屏蔽复杂性,向外暴露简单,直观的 API,来简化开发人员实现应用程序安全所花费的时间和精力 Shir">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-ShiroFeatures.png">
<meta property="og:image" content="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-ShiroBasicArchitecture.png">
<meta property="og:image" content="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-1-5714097.png">
<meta property="article:published_time" content="2022-05-26T13:33:02.000Z">
<meta property="article:modified_time" content="2022-05-26T13:33:02.000Z">
<meta property="article:author" content="Cian">
<meta property="article:tag" content="software computer programmer otes Cloud personal">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-ShiroFeatures.png">
  
  <title>Spring 整合 Shiro - SoftwareMagic</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"softwaremagic.lushan.tech","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/images/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/local-search.xml"};
  </script>
  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/utils.js" ></script>
  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 50vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>SoftwareMagic</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/background.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Spring 整合 Shiro">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-05-26 21:33" pubdate>
        2022年5月26日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      13k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      40 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring 整合 Shiro</h1>
            
            <div class="markdown-body">
              <h1>Spring 整合 Shiro</h1>
<ul>
<li>Apache Shiro 是一个功能强大,灵活的,开源的安全框架,它可以干净利落地处理身份验证,授权,企业会话管理和加密</li>
<li>Apache Shiro 的首要目标是易于使用和理解,安全通常很复杂,甚至让人感到很痛苦,但是 Shiro 却不是这样子的,一个好的安全框架应该屏蔽复杂性,向外暴露简单,直观的 API,来简化开发人员实现应用程序安全所花费的时间和精力</li>
<li>Shiro 能做什么呢？
<ul>
<li>验证用户身份</li>
<li>用户访问权限控制,比如:判断用户是否分配了一定的安全角色,判断用户是否被授予完成某个操作的权限</li>
<li>在非 Web 或 EJB 容器的环境下可以任意使用 Session API</li>
<li>可以响应认证,访问控制,或者 Session 生命周期中发生的事件</li>
<li>可将一个或以上用户安全数据源数据组合成一个复合的用户&quot;view”(视图)</li>
<li>支持单点登录(SSO)功能</li>
<li>支持提供&quot;Remember Me”服务,获取用户关联信息而无需登录</li>
<li>等等——都集成到一个有凝聚力的易于使用的 API</li>
</ul>
</li>
<li>Shiro 致力在所有应用环境下实现上述功能,小到命令行应用程序,大到企业应用中,而且不需要借助第三方框架,容器,应用服务器等,当然 Shiro 的目的是尽量的融入到这样的应用环境中去,但也可以在它们之外的任何环境下开箱即用</li>
</ul>
<h2 id="Shiro-特性">Shiro 特性</h2>
<ul>
<li>Apache Shiro 是一个全面的,蕴含丰富功能的安全框架,下图为描述 Shiro 功能的框架图:</li>
</ul>
<p><img src="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-ShiroFeatures.png" srcset="/images/loading.gif" lazyload alt=""></p>
<ul>
<li>Authentication(认证), Authorization(授权), Session Management(会话管理), Cryptography(加密)被 Shiro 框架的开发团队称之为应用安全的四大基石,那么就让我们来看看它们吧:
<ul>
<li><strong>Authentication(认证)</strong>:用户身份识别,通常被称为用户&quot;登录”</li>
<li><strong>Authorization(授权)</strong>:访问控制,比如某个用户是否具有某个操作的使用权限</li>
<li><strong>Session Management(会话管理)</strong>:特定于用户的会话管理,甚至在非web 或 EJB 应用程序</li>
<li><strong>Cryptography(加密)</strong>:在对数据源使用加密算法加密的同时,保证易于使用</li>
</ul>
</li>
<li>还有其他的功能来支持和加强这些不同应用环境下安全领域的关注点,特别是对以下的功能支持:
<ul>
<li>Web支持:Shiro 提供的 Web 支持 api,可以很轻松的保护 Web 应用程序的安全</li>
<li>缓存:缓存是 Apache Shiro 保证安全操作快速,高效的重要手段</li>
<li>并发:Apache Shiro 支持多线程应用程序的并发特性</li>
<li>测试:支持单元测试和集成测试,确保代码和预想的一样安全</li>
<li>Run As:这个功能允许用户假设另一个用户的身份(在许可的前提下)</li>
<li>Remember Me:跨 session 记录用户的身份,只有在强制需要时才需要登录</li>
</ul>
</li>
<li><strong>注意</strong>:Shiro 不会去维护用户,维护权限,这些需要我们自己去设计/提供,然后通过相应的接口注入给 Shiro</li>
</ul>
<h2 id="High-Level-Overview-高级概述">High-Level Overview 高级概述</h2>
<ul>
<li>在概念层,Shiro 架构包含三个主要的理念:Subject,SecurityManager和 Realm,下面的图展示了这些组件如何相互作用,我们将在下面依次对其进行描述</li>
</ul>
<p><img src="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-ShiroBasicArchitecture.png" srcset="/images/loading.gif" lazyload alt=""></p>
<ul>
<li>
<p>Subject:当前用户,Subject 可以是一个人,但也可以是第三方服务,守护进程帐户,时钟守护任务或者其它–当前和软件交互的任何事件</p>
</li>
<li>
<p>SecurityManager:管理所有Subject,SecurityManager 是 Shiro 架构的核心,配合内部安全组件共同组成安全伞</p>
</li>
<li>
<p>Realms:用于进行权限信息的验证,由我们自己实现,Realm 本质上是一个特定的安全 DAO,它封装与数据源连接的细节,得到Shiro 所需的相关的数据,在配置 Shiro 的时候,你必须指定至少一个Realm 来实现认证(authentication)和/或授权(authorization)</p>
</li>
<li>
<p>我们需要实现Realms的Authentication 和 Authorization,其中 Authentication 是用来验证用户身份,Authorization 是授权访问控制,用于对用户进行的操作授权,证明该用户是否允许进行当前操作,如访问某个链接,某个资源文件等</p>
</li>
</ul>
<h2 id="运行原理">运行原理</h2>
<p><img src="https://raw.githubusercontent.com/LuShan123888/Files/main/Pictures/2020-12-10-2020-11-18-1-5714097.png" srcset="/images/loading.gif" lazyload alt=""></p>
<ol>
<li>Subject:主体,可以看到主体可以是任何与应用交互的&quot;用户”</li>
<li>SecurityManager:相当于 SpringMVC 中的 DispatcherServlet 或者 Struts2 中的 FilterDispatcher,它是 Shiro 的核心,所有具体的交互都通过 SecurityManager 进行控制,它管理着所有 Subject,且负责进行认证和授权,及会话,缓存的管理</li>
<li>Authenticator:认证器,负责主体认证的,这是一个扩展点,如果用户觉得 Shiro 默认的不好,我们可以自定义实现,其需要认证策略(Authentication Strategy),即什么情况下算用户认证通过了</li>
<li>Authrizer:授权器,或者访问控制器,它用来决定主体是否有权限进行相应的操作,即控制着用户能访问应用中的哪些功能</li>
<li>Realm:可以有1个或多个 Realm,可以认为是安全实体数据源,即用于获取安全实体的,它可以是 JDBC 实现,也可以是 LDAP 实现,或者内存实现等</li>
<li>SessionManager:如果写过 Servlet 就应该知道 Session 的概念,Session 需要有人去管理它的生命周期,这个组件就是 SessionManager,而 Shiro 并不仅仅可以用在 Web 环境,也可以用在如普通的 JavaSE 环境</li>
<li>SessionDAO:数据访问对象,用于会话的 CRUD,我们可以自定义 SessionDAO 的实现,控制 session 存储的位置,如通过 JDBC 写到数据库或通过 jedis 写入 Redis 中,另外 SessionDAO 中可以使用 Cache 进行缓存,以提高性能</li>
<li>CacheManager:缓存管理器,它来管理如用户,角色,权限等的缓存的,因为这些数据基本上很少去改变,放到缓存中后可以提高访问的性能</li>
<li>Cryptography:密码模块,Shiro 提高了一些常见的加密组件用于如密码加密/解密的</li>
</ol>
<h2 id="pom-xml">pom.xml</h2>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shiro<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>shiro-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<h2 id="实体类">实体类</h2>
<h3 id="用户信息">用户信息</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Long id; <span class="hljs-comment">// 主键</span><br>    <span class="hljs-keyword">private</span> String username; <span class="hljs-comment">// 登录账户,唯一</span><br>    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">// 名称(匿名或真实姓名),用于UI显示</span><br>    <span class="hljs-keyword">private</span> String password; <span class="hljs-comment">// 密码</span><br>    <span class="hljs-keyword">private</span> String salt; <span class="hljs-comment">// 加密密码的盐</span><br>    <span class="hljs-meta">@JsonIgnoreProperties(value = &#123;&quot;userInfos&quot;&#125;)</span><br>    <span class="hljs-keyword">private</span> List&lt;SysRole&gt; roles; <span class="hljs-comment">// 一个用户具有多个角色</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="角色信息">角色信息</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SysRole</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Long id; <span class="hljs-comment">// 主键</span><br>    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">// 角色名称,如 admin/user</span><br>    <span class="hljs-keyword">private</span> String description; <span class="hljs-comment">// 角色描述,用于UI显示</span><br>    <span class="hljs-comment">// 角色 -- 权限关系:多对多</span><br>    <span class="hljs-meta">@JsonIgnoreProperties(value = &#123;&quot;roles&quot;&#125;)</span><br>    <span class="hljs-keyword">private</span> List&lt;SysPermission&gt; permissions;<br>    <span class="hljs-comment">// 用户 -- 角色关系:多对多</span><br>    <span class="hljs-meta">@JsonIgnoreProperties(value = &#123;&quot;roles&quot;&#125;)</span><br>    <span class="hljs-keyword">private</span> List&lt;UserInfo&gt; userInfos;<span class="hljs-comment">// 一个角色对应多个用户</span><br><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="权限信息">权限信息</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SysPermission</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Long id; <span class="hljs-comment">// 主键</span><br>    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">// 权限名称,如 user:select</span><br>    <span class="hljs-keyword">private</span> String description; <span class="hljs-comment">// 权限描述,用于UI显示</span><br>    <span class="hljs-keyword">private</span> String url; <span class="hljs-comment">// 权限地址</span><br>    <span class="hljs-meta">@JsonIgnoreProperties(value = &#123;&quot;permissions&quot;&#125;)</span><br>    <span class="hljs-keyword">private</span> List&lt;SysRole&gt; roles; <span class="hljs-comment">// 一个权限可以被多个角色使用</span><br><br>&#125;<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>注意</strong>:当要使用RESTful风格返回给前台JSON数据的时候,比如当我们想要返回给前台一个用户信息时,由于一个用户拥有多个角色,一个角色又拥有多个权限,而权限跟角色也是多对多的关系,也就是造成了 查用户→查角色→查权限→查角色→查用户…这样的无限循环,导致传输错误,所以我们根据这样的逻辑在每一个实体类返回JSON时使用了一个<code>@JsonIgnoreProperties</code>注解,来排除自身的无限引用的过程,也就是打断这样的无限循环</li>
</ul>
<h2 id="MyShiroRealm">MyShiroRealm</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyShiroRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserInfoService userInfoService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> </span>&#123;<br>        SimpleAuthorizationInfo simpleAuthorizationInfo = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();<br>        <span class="hljs-comment">// 运行到这里说明用户已经通过验证了</span><br>        UserInfo userInfo = (UserInfo) principalCollection.getPrimaryPrincipal();<br>        <span class="hljs-keyword">for</span> (SysRole role : userInfo.getRoles()) &#123;<br>            simpleAuthorizationInfo.addRole(role.getName());<br>            <span class="hljs-keyword">for</span> (SysPermission permission : role.getPermissions()) &#123;<br>                simpleAuthorizationInfo.addStringPermission(permission.getName());<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> simpleAuthorizationInfo;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br>        <span class="hljs-comment">// 获取用户输入的账户</span><br>        String username = (String) authenticationToken.getPrincipal();<br>        System.out.println(authenticationToken.getPrincipal());<br>        <span class="hljs-comment">// 通过username从数据库中查找 UserInfo 对象</span><br>        <span class="hljs-comment">// 实际项目中,这里可以根据实际情况做缓存,如果不做,Shiro自己也是有时间间隔机制,2分钟内不会重复执行该方法</span><br>        UserInfo userInfo = userInfoService.findByUsername(username);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == userInfo) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br><br>        SimpleAuthenticationInfo simpleAuthenticationInfo = <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(<br>            userInfo, <span class="hljs-comment">// 用户名</span><br>            userInfo.getPassword(), <span class="hljs-comment">// 密码</span><br>            ByteSource.Util.bytes(userInfo.getSalt()), <span class="hljs-comment">// salt=username+salt</span><br>            getName() <span class="hljs-comment">// realm name</span><br>        );<br>        <span class="hljs-keyword">return</span> simpleAuthenticationInfo;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="ShiroConfig">ShiroConfig</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span> </span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title">shirFilter</span><span class="hljs-params">(SecurityManager securityManager)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ShiroConfiguration.shirFilter()&quot;</span>);<br>        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();<br>        shiroFilterFactoryBean.setSecurityManager(securityManager);<br>        <span class="hljs-comment">// 拦截器</span><br>        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="hljs-keyword">new</span> LinkedHashMap&lt;String, String&gt;();<br>        <span class="hljs-comment">// 配置不会被拦截的链接以顺序判断</span><br>        filterChainDefinitionMap.put(<span class="hljs-string">&quot;/static/**&quot;</span>, <span class="hljs-string">&quot;anon&quot;</span>);<br>        <span class="hljs-comment">// 配置退出过滤器</span><br>        filterChainDefinitionMap.put(<span class="hljs-string">&quot;/logout&quot;</span>, <span class="hljs-string">&quot;logout&quot;</span>);<br>        <span class="hljs-comment">// 过滤链定义,从上向下顺序执行,一般将/**放在最为下边</span><br>        filterChainDefinitionMap.put(<span class="hljs-string">&quot;/**&quot;</span>, <span class="hljs-string">&quot;authc&quot;</span>);<br>        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);<br><br>        <span class="hljs-comment">// 登陆Url,如果不设置默认会自动寻找Web工程根目录下的&quot;/login.jsp&quot;页面</span><br>        shiroFilterFactoryBean.setLoginUrl(<span class="hljs-string">&quot;/login&quot;</span>);<br>        <span class="hljs-comment">// 登录成功后要跳转的链接</span><br>        shiroFilterFactoryBean.setSuccessUrl(<span class="hljs-string">&quot;/index&quot;</span>);<br>        <span class="hljs-comment">//未授权界面;</span><br>        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="hljs-string">&quot;/403&quot;</span>);<br>        <span class="hljs-keyword">return</span> shiroFilterFactoryBean;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 凭证匹配器</span><br><span class="hljs-comment">     *(由于密码校验交给Shiro的SimpleAuthenticationInfo进行处理了)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> HashedCredentialsMatcher <span class="hljs-title">hashedCredentialsMatcher</span><span class="hljs-params">()</span> </span>&#123;<br>        HashedCredentialsMatcher hashedCredentialsMatcher = <span class="hljs-keyword">new</span> HashedCredentialsMatcher();<br>        hashedCredentialsMatcher.setHashAlgorithmName(<span class="hljs-string">&quot;md5&quot;</span>); <span class="hljs-comment">// 散列算法:这里使用MD5算法;</span><br>        hashedCredentialsMatcher.setHashIterations(<span class="hljs-number">2</span>); <span class="hljs-comment">// 散列的次数,比如散列两次,相当于 md5(md5(&quot;&quot;));</span><br>        <span class="hljs-keyword">return</span> hashedCredentialsMatcher;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> MyShiroRealm <span class="hljs-title">myShiroRealm</span><span class="hljs-params">()</span> </span>&#123;<br>        MyShiroRealm myShiroRealm = <span class="hljs-keyword">new</span> MyShiroRealm();<br>        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());<br>        <span class="hljs-keyword">return</span> myShiroRealm;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SecurityManager <span class="hljs-title">securityManager</span><span class="hljs-params">()</span> </span>&#123;<br>        DefaultWebSecurityManager securityManager = <span class="hljs-keyword">new</span> DefaultWebSecurityManager();<br>        securityManager.setRealm(myShiroRealm());<br>        <span class="hljs-keyword">return</span> securityManager;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 开启shiro aop注解支持</span><br><span class="hljs-comment">     * 使用代理方式;所以需要开启代码支持;</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> securityManager</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="hljs-title">authorizationAttributeSourceAdvisor</span><span class="hljs-params">(SecurityManager securityManager)</span> </span>&#123;<br>        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="hljs-keyword">new</span> AuthorizationAttributeSourceAdvisor();<br>        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);<br>        <span class="hljs-keyword">return</span> authorizationAttributeSourceAdvisor;<br>    &#125;<br><br>    <span class="hljs-meta">@Bean(name = &quot;simpleMappingExceptionResolver&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> SimpleMappingExceptionResolver <span class="hljs-title">createSimpleMappingExceptionResolver</span><span class="hljs-params">()</span> </span>&#123;<br>        SimpleMappingExceptionResolver r = <span class="hljs-keyword">new</span> SimpleMappingExceptionResolver();<br>        Properties mappings = <span class="hljs-keyword">new</span> Properties();<br>        mappings.setProperty(<span class="hljs-string">&quot;DatabaseException&quot;</span>, <span class="hljs-string">&quot;databaseError&quot;</span>); <span class="hljs-comment">// 数据库异常处理</span><br>        mappings.setProperty(<span class="hljs-string">&quot;UnauthorizedException&quot;</span>, <span class="hljs-string">&quot;403&quot;</span>);<br>        r.setExceptionMappings(mappings);  <span class="hljs-comment">// None by default</span><br>        r.setDefaultErrorView(<span class="hljs-string">&quot;error&quot;</span>);    <span class="hljs-comment">// No default</span><br>        r.setExceptionAttribute(<span class="hljs-string">&quot;ex&quot;</span>);     <span class="hljs-comment">// Default is &quot;exception&quot;</span><br>        <span class="hljs-comment">//r.setWarnLogCategory(&quot;example.MvcLogger&quot;);     // No default</span><br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="过滤器">过滤器</h3>
<ul>
<li>Filter Chain定义说明
<ul>
<li>一个URL可以配置多个Filter,使用逗号分隔</li>
<li>当设置多个过滤器时,全部验证通过,才视为通过</li>
<li>部分过滤器可指定参数,如perms,roles</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">过滤器简称</th>
<th style="text-align:center">对应的 Java 类</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">anon</td>
<td style="text-align:center">org.apache.shiro.web.filter.authc.AnonymousFilter</td>
</tr>
<tr>
<td style="text-align:center">authc</td>
<td style="text-align:center">org.apache.shiro.web.filter.authc.FormAuthenticationFilter</td>
</tr>
<tr>
<td style="text-align:center">authcBasic</td>
<td style="text-align:center">org.apache.shiro.web.filter.authc.BasicHttpAuthenticationFilter</td>
</tr>
<tr>
<td style="text-align:center">perms</td>
<td style="text-align:center">org.apache.shiro.web.filter.authz.PermissionsAuthorizationFilter</td>
</tr>
<tr>
<td style="text-align:center">port</td>
<td style="text-align:center">org.apache.shiro.web.filter.authz.PortFilter</td>
</tr>
<tr>
<td style="text-align:center">rest</td>
<td style="text-align:center">org.apache.shiro.web.filter.authz.HttpMethodPermissionFilter</td>
</tr>
<tr>
<td style="text-align:center">roles</td>
<td style="text-align:center">org.apache.shiro.web.filter.authz.RolesAuthorizationFilter</td>
</tr>
<tr>
<td style="text-align:center">ssl</td>
<td style="text-align:center">org.apache.shiro.web.filter.authz.SslFilter</td>
</tr>
<tr>
<td style="text-align:center">user</td>
<td style="text-align:center">org.apache.shiro.web.filter.authc.UserFilter</td>
</tr>
<tr>
<td style="text-align:center">logout</td>
<td style="text-align:center">org.apache.shiro.web.filter.authc.LogoutFilter noSessionCreation</td>
</tr>
</tbody>
</table>
<ul>
<li><code>anon</code>:表示任何人都可以访问</li>
<li><code>authc </code>:表示该 uri 需要认证才能访问</li>
<li><code>authcBasic</code>:表示该 uri 需要 httpBasic 认证</li>
<li><code>perms[user:add:*]</code>:表示该 uri 需要认证用户拥有 user:add:* 权限才能访问</li>
<li><code>port[8081]</code>:表示该 uri 需要使用 8081 端口</li>
<li><code>rest[user]</code>:相当于<code>/admins/=perms[user:method]</code>,其中,method 表示  get,post,delete 等</li>
<li><code>roles[admin]</code>:表示该 uri 需要认证用户拥有 admin 角色才能访问</li>
<li><code>ssl</code>:表示该 uri 需要使用 https 协议</li>
<li><code>user</code>:表示该 uri 需要认证或通过记住我认证才能访问</li>
<li><code>logout</code>:表示注销,可以当作固定配置</li>
</ul>
<p><strong>注意</strong></p>
<ul>
<li>anon,authcBasic,auchc,user 是认证过滤器</li>
<li>perms,roles,ssl,rest,port 是授权过滤器</li>
</ul>
<h2 id="ShiroController">ShiroController</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroController</span> </span>&#123;<br><br>    <span class="hljs-meta">@GetMapping(&#123;&quot;/&quot;, &quot;/index&quot;&#125;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toIndex</span><span class="hljs-params">(Model model)</span> </span>&#123;<br>        model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Hello Shiro&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/toLogin&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toLogin</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequiresRoles( &quot;admin&quot; )</span><br>    <span class="hljs-meta">@RequiresPermissions(&quot;userInfo:add&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/user/add&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">add</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user/add&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequiresRoles( &quot;admin&quot;)</span><br>    <span class="hljs-meta">@RequiresPermissions(&quot;userInfo:update&quot;)</span><br>    <span class="hljs-meta">@GetMapping(&quot;/user/update&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">update</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;user/update&quot;</span>;<br>    &#125;<br><br><br>    <span class="hljs-meta">@RequestMapping(&quot;/login&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String username, String password, Model model)</span> </span>&#123;<br>        <span class="hljs-comment">//获取当前的用户</span><br>        Subject currentUser = SecurityUtils.getSubject();<br>        <span class="hljs-comment">//封装用户的登录数据</span><br>        UsernamePasswordToken token = <span class="hljs-keyword">new</span> UsernamePasswordToken(username, password);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//执行登录的方法</span><br>            currentUser.login(token);<br>            <span class="hljs-comment">//开启记住登录状态功能</span><br>            token.setRememberMe(<span class="hljs-keyword">true</span>);<br>            <span class="hljs-comment">//用户名不存在</span><br>        &#125; <span class="hljs-keyword">catch</span> (UnknownAccountException e) &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;用户名错误&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>            <span class="hljs-comment">//密码不存在</span><br>        &#125; <span class="hljs-keyword">catch</span> (IncorrectCredentialsException e) &#123;<br>            model.addAttribute(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;密码错误&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>            <span class="hljs-comment">//账户被锁定</span><br>        &#125; <span class="hljs-keyword">catch</span> (LockedAccountException e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;用户名 &quot;</span> + token.getPrincipal() + <span class="hljs-string">&quot; 被锁定 !&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;login&quot;</span>;<br>        &#125;<br>        <span class="hljs-comment">// 认证成功后</span><br>        <span class="hljs-keyword">if</span> (currentUser.isAuthenticated()) &#123;<br>            System.out.println(<span class="hljs-string">&quot;用户 &quot;</span> + currentUser.getPrincipal() + <span class="hljs-string">&quot; 登陆成功!&quot;</span>);<br>            <span class="hljs-comment">//测试角色</span><br>            System.out.println(<span class="hljs-string">&quot;是否拥有 manager 角色:&quot;</span> + currentUser.hasRole(<span class="hljs-string">&quot;manager&quot;</span>));<br>            <span class="hljs-comment">//测试权限</span><br>            System.out.println(<span class="hljs-string">&quot;是否拥有 user:create 权限&quot;</span> + currentUser.isPermitted(<span class="hljs-string">&quot;user:create&quot;</span>));<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/403&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">unauthorized</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;未经授权无法访问此页面&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@RequestMapping(&quot;/logout&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">logout</span><span class="hljs-params">()</span> </span>&#123;<br>        Subject currentUser = SecurityUtils.getSubject();<br>        currentUser.logout();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;注销成功&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="注解">注解</h2>
<ul>
<li>在使用 Shiro 的注解之前,请确保项目中已经添加支持 AOP 功能的相关jar包</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//角色校验</span><br><span class="hljs-meta">@RequiresRoles( &quot;manager&quot; )</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">//TODO</span><br>&#125;<br><span class="hljs-comment">//权限校验</span><br><span class="hljs-meta">@RequiresPermissions(&quot;user:manage&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">delete</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">//TODO</span><br>&#125;<br><span class="hljs-comment">//用户校验</span><br><span class="hljs-meta">@RequiresUser</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,Object&gt; <span class="hljs-title">getLogout</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">//TODO</span><br>&#125;<br></code></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>注解名称</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>@RequiresAuthentication</td>
<td>使用该注解标注的类,方法等在访问时,当前Subject必须在当前session中已经过认证</td>
</tr>
<tr>
<td>@RequiresGuest</td>
<td>使用该注解标注的类,方法等在访问时,当前Subject可以是&quot;Guest&quot;身份,不需要经过认证或者在原先的session中存在记录</td>
</tr>
<tr>
<td>@RequersUser</td>
<td>验证用户是否被记忆,有两种含义一种是成功登录的(subject.isAuthenticated()结果为true);另外一种是被记忆的(subject.isRemembere()结果为true).</td>
</tr>
<tr>
<td>@RequiresPermission</td>
<td>当前Subject需要拥有某些特定的权限时,才能执行被该注解标主的方法如果没有权限,则方法不会执行还会抛出AuthorizationException异常</td>
</tr>
<tr>
<td>@RequiresRoles</td>
<td>当前Subject必须拥有所有指定的角色时,才能访问被该注解标主的方法如果没有角色则方法不会执行还会抛出AuthorizationException异常</td>
</tr>
</tbody>
</table>
<ul>
<li>允许存在多个角色和权限, 默认逻辑是 AND, 也就是同时拥有这些才可以访问方法, 可以在注解中以参数的形式设置成 OR</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//拥有其中一个角色就可以访问</span><br><span class="hljs-meta">@RequiresRoles(value=&#123;&quot;ADMIN&quot;,&quot;USER&quot;&#125;,logical = Logical.OR)</span><br><span class="hljs-comment">//拥有所有权限才可以访问</span><br><span class="hljs-meta">@RequiresPermissions</span> (value=&#123;<span class="hljs-string">&quot;sys:user:info&quot;</span> ,<span class="hljs-string">&quot;sys:role: info&quot;</span>, logical = Logical.AND)<br></code></pre></td></tr></table></figure>
<ul>
<li>Shiro 注解是存在顺序的, 当多个注解在一个方法上的时候, 会逐个检查, 知道全部通过为止</li>
<li>默认拦截顺序是: RequiresRoles-&gt;RequiresPermissions-&gt;RequiresAuthentication-&gt;RequiresUser-&gt;RequiresGuest</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//拥有ADMIN角色同时还要拥有有sys:role:info权限</span><br><span class="hljs-meta">@RequiresRoles</span> (value=&#123;<span class="hljs-string">&quot;ADMIN&quot;</span>)<br><span class="hljs-meta">@RequiresPermissions(&quot;sys:role:info&quot;)</span><br></code></pre></td></tr></table></figure>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Software/">Software</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/BackEnd/">BackEnd</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/BackEnd/SpringFramework/">SpringFramework</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/BackEnd/SpringFramework/Spring/">Spring</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Software/BackEnd/Server/Nginx/%E9%85%8D%E7%BD%AE/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Nginx 配置</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/Software/BackEnd/SpringFramework/Spring/%E6%B5%8B%E8%AF%95/">
                        <span class="hidden-mobile">Spring 测试</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                

              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
    
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/events.js" ></script>
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/local-search.js" ></script>



  
    <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>







<!-- 主题的启动项 保持在最底部 -->
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/boot.js" ></script>


</body>
</html>
