

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/logo.png">
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Cian">
  <meta name="keywords" content="software computer programmer otes Cloud personal">
  <meta name="description" content="MySQL JSON  JSON 数据类型是 MySQL 5.7.8 开始支持的。在此之前，只能通过字符类型（CHAR，VARCHAR 或 TEXT ）来保存 JSON 文档。 相对字符类型，原生的 JSON 类型具有以下优势：  在插入时能自动校验文档是否满足 JSON 格式的要求。 优化了存储格式。无需读取整个文档就能快速访问某个元素的值。   在 JSON 类型引入之前，如果我们想要获取 J">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL JSON">
<meta property="og:url" content="https://softwaremagic.lushan.tech/Software/BackEnd/Database/MySQL/JSON/">
<meta property="og:site_name" content="SoftwareMagic">
<meta property="og:description" content="MySQL JSON  JSON 数据类型是 MySQL 5.7.8 开始支持的。在此之前，只能通过字符类型（CHAR，VARCHAR 或 TEXT ）来保存 JSON 文档。 相对字符类型，原生的 JSON 类型具有以下优势：  在插入时能自动校验文档是否满足 JSON 格式的要求。 优化了存储格式。无需读取整个文档就能快速访问某个元素的值。   在 JSON 类型引入之前，如果我们想要获取 J">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-10-03T17:04:40.000Z">
<meta property="article:modified_time" content="2024-03-17T17:44:00.516Z">
<meta property="article:author" content="Cian">
<meta property="article:tag" content="software computer programmer otes Cloud personal">
<meta name="twitter:card" content="summary_large_image">
  
  <title>MySQL JSON - SoftwareMagic</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"softwaremagic.lushan.tech","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/images/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname"}},"search_path":"https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/local-search.xml"};
  </script>
  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/utils.js" ></script>
  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 50vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>SoftwareMagic</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/images/background.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MySQL JSON">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-10-04 01:04" pubdate>
        2022年10月4日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      50k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      157 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL JSON</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2024年3月18日 凌晨
                
              </p>
            
            <div class="markdown-body">
              <h1>MySQL JSON</h1>
<ul>
<li>JSON 数据类型是 MySQL 5.7.8 开始支持的。在此之前，只能通过字符类型（CHAR，VARCHAR 或 TEXT ）来保存 JSON 文档。</li>
<li>相对字符类型，原生的 JSON 类型具有以下优势：
<ol>
<li>在插入时能自动校验文档是否满足 JSON 格式的要求。</li>
<li>优化了存储格式。无需读取整个文档就能快速访问某个元素的值。</li>
</ol>
</li>
<li>在 JSON 类型引入之前，如果我们想要获取 JSON 文档中的某个元素，必须首先读取整个 JSON 文档，然后在客户端将其转换为 JSON 对象，最后再通过对象获取指定元素的值。</li>
</ul>
<h2 id="CRUD">CRUD</h2>
<h3 id="插入操作">插入操作</h3>
<ul>
<li>可直接插入 JSON 格式的字符串。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t(c1 json);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;[1, &quot;abc&quot;, null, true, &quot;08:45:06.000000&quot;]&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t <span class="hljs-keyword">values</span>(<span class="hljs-string">&#x27;&#123;&quot;id&quot;: 87, &quot;name&quot;: &quot;carrot&quot;&#125;&#x27;</span>);<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-ARRAY-和-JSON-OBJECT">JSON_ARRAY()和 JSON_OBJECT()</h4>
<ul>
<li>前者用于构造 JSON 数组，后者用于构造 JSON 对象。如，</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs lua">mysql&gt; <span class="hljs-built_in">select</span> json_array(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;abc&quot;</span>, null, <span class="hljs-literal">true</span>,curtime());<br>+<span class="hljs-comment">--------------------------------------------+</span><br>| json_array(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;abc&quot;</span>, null, <span class="hljs-literal">true</span>,curtime()) |<br>+<span class="hljs-comment">--------------------------------------------+</span><br>| [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;abc&quot;</span>, null, <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;10:12:25.000000&quot;</span>]  |<br>+<span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.01</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_object(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-number">87</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;carrot&#x27;</span>);<br>+<span class="hljs-comment">-----------------------------------------+</span><br>| json_object(<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-number">87</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;carrot&#x27;</span>) |<br>+<span class="hljs-comment">-----------------------------------------+</span><br>| &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">87</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;carrot&quot;</span>&#125;            |<br>+<span class="hljs-comment">-----------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>对于 JSON 文档，KEY 名不能重复。</li>
<li>如果插入的值中存在重复 KEY，在 MySQL 8.0.3 之前，遵循 first duplicate key wins 原则，会保留第一个 KEY，后面的将被丢弃掉。从 MySQL 8.0.3 开始，遵循的是 last duplicate key wins 原则，只会保留最后一个 KEY。</li>
</ul>
<h3 id="查询操作">查询操作</h3>
<h4 id="JSON-EXTRACT-json-doc-path-path-…">JSON_EXTRACT(json_doc, path[, path] …)</h4>
<ul>
<li>其中，json_doc 是 JSON 文档，path 是路径。该函数会从 JSON 文档提取指定路径（path）的元素。如果指定 path 不存在，会返回 NULL。可指定多个 path，匹配到的多个值会以数组形式返回。</li>
</ul>
<h5 id="数组">数组</h5>
<ul>
<li>首先我们看看数组，数组的路径是通过下标来表示的。第一个元素的下标是 0。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-operator">|</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">10</span>                                         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&#x27;$[2][0]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&#x27;$[2][0]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>]                                                 <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>除此之外，还可通过 <code>[M to N]</code> 获取数组的子集。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[0 to 1]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[0 to 1]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------+</span><br><span class="hljs-operator">|</span> [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>]                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br># 这里的 <span class="hljs-keyword">last</span> 代表最后一个元素的下标<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[last-1 to last]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[last-1 to last]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------------------+</span><br><span class="hljs-operator">|</span> [<span class="hljs-number">20</span>, [<span class="hljs-number">30</span>, <span class="hljs-number">40</span>]]                                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>也可通过 <code>[*]</code> 获取数组中的所有元素。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[*]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-operator">|</span> json_extract(<span class="hljs-string">&#x27;[10, 20, [30, 40]]&#x27;</span>, <span class="hljs-string">&#x27;$[*]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-operator">|</span> [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, [<span class="hljs-number">30</span>, <span class="hljs-number">40</span>]]                         <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h5 id="对象">对象</h5>
<ul>
<li>对象的路径是通过 KEY 来表示的。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-variable">@j</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: [2, 3], &quot;a c&quot;: 4&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br># 如果 KEY 在路径表达式中不合法（譬如存在空格），则在引用这个 KEY 时，需用双引号括起来。<br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_extract(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>), json_extract(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;$.&quot;a c&quot;&#x27;</span>), json_extract(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;$.b[1]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-----------------------------+----------------------------+</span><br><span class="hljs-operator">|</span> json_extract(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>) <span class="hljs-operator">|</span> json_extract(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;$.&quot;a c&quot;&#x27;</span>) <span class="hljs-operator">|</span> json_extract(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;$.b[1]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-----------------------------+----------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">1</span>                       <span class="hljs-operator">|</span> <span class="hljs-number">4</span>                           <span class="hljs-operator">|</span> <span class="hljs-number">3</span>                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-----------------------------+----------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>除此之外，还可通过 <code>.*</code> 获取对象中的所有元素。</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">mysql</span>&gt; select json_extract(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">&quot;a c&quot;</span>: <span class="hljs-number">4</span>&#125;&#x27;, &#x27;$.*&#x27;);<br>+<span class="hljs-comment">--------------------------------------------------------+</span><br>| json_extract(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">&quot;a c&quot;</span>: <span class="hljs-number">4</span>&#125;&#x27;, &#x27;$.*&#x27;) |<br>+<span class="hljs-comment">--------------------------------------------------------+</span><br>| [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">4</span>]                                         |<br>+<span class="hljs-comment">--------------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-meta"># 这里的 $**.b 匹配 $.a.b 和 $.c.b</span><br><span class="hljs-title">mysql</span>&gt; select json_extract(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span>&#125;, <span class="hljs-string">&quot;c&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;&#x27;, &#x27;$**.b&#x27;);<br>+<span class="hljs-comment">---------------------------------------------------------+</span><br>| json_extract(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">1</span>&#125;, <span class="hljs-string">&quot;c&quot;</span>: &#123;<span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;&#125;&#x27;, &#x27;$**.b&#x27;) |<br>+<span class="hljs-comment">---------------------------------------------------------+</span><br>| [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]                                                  |<br>+<span class="hljs-comment">---------------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="column-path">column-&gt;path</h4>
<ul>
<li>column-&gt;path，包括后面讲到的 column-&gt;&gt;path，都是语法糖，在实际使用的时候都会转化为 JSON_EXTRACT。</li>
<li>column-&gt;path 等同于 JSON_EXTRACT(column, path) ，只能指定一个path。</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">create</span> table t(c2 json);<br><br><span class="hljs-title">insert</span> into t values(&#x27;&#123;<span class="hljs-string">&quot;empno&quot;</span>: <span class="hljs-number">1001</span>, <span class="hljs-string">&quot;ename&quot;</span>: <span class="hljs-string">&quot;jack&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;empno&quot;</span>: <span class="hljs-number">1002</span>, <span class="hljs-string">&quot;ename&quot;</span>: <span class="hljs-string">&quot;mark&quot;</span>&#125;&#x27;);<br><br><span class="hljs-title">mysql</span>&gt; select c2, c2-&gt;<span class="hljs-string">&quot;$.ename&quot;</span> from t;<br>+<span class="hljs-comment">----------------------------------+---------------+</span><br>| c2                               | c2-&gt;<span class="hljs-string">&quot;$.ename&quot;</span> |<br>+<span class="hljs-comment">----------------------------------+---------------+</span><br>| &#123;<span class="hljs-string">&quot;empno&quot;</span>: <span class="hljs-number">1001</span>, <span class="hljs-string">&quot;ename&quot;</span>: <span class="hljs-string">&quot;jack&quot;</span>&#125; | <span class="hljs-string">&quot;jack&quot;</span>        |<br>| &#123;<span class="hljs-string">&quot;empno&quot;</span>: <span class="hljs-number">1002</span>, <span class="hljs-string">&quot;ename&quot;</span>: <span class="hljs-string">&quot;mark&quot;</span>&#125; | <span class="hljs-string">&quot;mark&quot;</span>        |<br>+<span class="hljs-comment">----------------------------------+---------------+</span><br><span class="hljs-number">2</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-title">mysql</span>&gt; select * from t <span class="hljs-keyword">where</span> c2-&gt;<span class="hljs-string">&quot;$.empno&quot;</span> = <span class="hljs-number">1001</span>;<br>+<span class="hljs-comment">------+----------------------------------+</span><br>| c1   | c2                               |<br>+<span class="hljs-comment">------+----------------------------------+</span><br>|    <span class="hljs-number">1</span> | &#123;<span class="hljs-string">&quot;empno&quot;</span>: <span class="hljs-number">1001</span>, <span class="hljs-string">&quot;ename&quot;</span>: <span class="hljs-string">&quot;jack&quot;</span>&#125; |<br>+<span class="hljs-comment">------+----------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="column-path-2">column-&gt;&gt;path</h4>
<ul>
<li>
<p>同 column-&gt;path 类似，只不过其返回的是字符串。以下三者是等价的。</p>
<ul>
<li>
<p>JSON_UNQUOTE( JSON_EXTRACT(column, path) )</p>
</li>
<li>
<p>JSON_UNQUOTE(column -&gt; path)</p>
</li>
<li>
<p>column-&gt;&gt;path</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>,json_extract(c2, &quot;$.ename&quot;),json_unquote(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>),c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span> <span class="hljs-keyword">from</span> t;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------------------------+-----------------------------+----------------+</span><br><span class="hljs-operator">|</span> c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span> <span class="hljs-operator">|</span> json_extract(c2, &quot;$.ename&quot;) <span class="hljs-operator">|</span> json_unquote(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>) <span class="hljs-operator">|</span> c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------------------------+-----------------------------+----------------+</span><br><span class="hljs-operator">|</span> &quot;jack&quot;        <span class="hljs-operator">|</span> &quot;jack&quot;                      <span class="hljs-operator">|</span> jack                        <span class="hljs-operator">|</span> jack           <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> &quot;mark&quot;        <span class="hljs-operator">|</span> &quot;mark&quot;                      <span class="hljs-operator">|</span> mark                        <span class="hljs-operator">|</span> mark           <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------------------------+-----------------------------+----------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h3 id="修改操作">修改操作</h3>
<h4 id="JSON-INSERT-json-doc-path-val-path-val-…"><strong>JSON_INSERT(json_doc, path, val[, path, val] …)</strong></h4>
<ul>
<li>插入新值。仅当指定位置或指定 KEY 的值不存在时，才执行插入操作。另外，如果指定的 path 是数组下标，且 json_doc 不是数组，该函数首先会将 json_doc 转化为数组，然后再插入新值。</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs lua">mysql&gt; <span class="hljs-built_in">select</span> json_insert(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;$[0]&#x27;</span>,<span class="hljs-string">&quot;10&quot;</span>);<br>+<span class="hljs-comment">------------------------------+</span><br>| json_insert(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;$[0]&#x27;</span>,<span class="hljs-string">&quot;10&quot;</span>) |<br>+<span class="hljs-comment">------------------------------+</span><br>| <span class="hljs-number">1</span>                            |<br>+<span class="hljs-comment">------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_insert(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&quot;10&quot;</span>);<br>+<span class="hljs-comment">------------------------------+</span><br>| json_insert(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&quot;10&quot;</span>) |<br>+<span class="hljs-comment">------------------------------+</span><br>| [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;10&quot;</span>]                    |<br>+<span class="hljs-comment">------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.01</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_insert(<span class="hljs-string">&#x27;[&quot;1&quot;,&quot;2&quot;]&#x27;</span>,<span class="hljs-string">&#x27;$[2]&#x27;</span>,<span class="hljs-string">&quot;10&quot;</span>);<br>+<span class="hljs-comment">--------------------------------------+</span><br>| json_insert(<span class="hljs-string">&#x27;[&quot;1&quot;,&quot;2&quot;]&#x27;</span>,<span class="hljs-string">&#x27;$[2]&#x27;</span>,<span class="hljs-string">&quot;10&quot;</span>) |<br>+<span class="hljs-comment">--------------------------------------+</span><br>| [<span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;10&quot;</span>]                     |<br>+<span class="hljs-comment">--------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; set @j = <span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3]&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_insert(@j, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;$.c&#x27;</span>, <span class="hljs-string">&#x27;[true, false]&#x27;</span>);<br>+<span class="hljs-comment">----------------------------------------------------+</span><br>| json_insert(@j, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;$.c&#x27;</span>, <span class="hljs-string">&#x27;[true, false]&#x27;</span>) |<br>+<span class="hljs-comment">----------------------------------------------------+</span><br>| &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-string">&quot;[true, false]&quot;</span>&#125;        |<br>+<span class="hljs-comment">----------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-SET-json-doc-path-val-path-val-…">JSON_SET(json_doc, path, val[, path, val] …)</h4>
<ul>
<li>插入新值，并替换已经存在的值。换言之，如果指定位置或指定 KEY 的值不存在，会执行插入操作，如果存在，则执行更新操作。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">mysql&gt; set <span class="hljs-meta">@j</span> = <span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3]&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_set</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;$.c&#x27;</span>, <span class="hljs-string">&#x27;[true, false]&#x27;</span>)</span></span>;<br>+-------------------------------------------------+<br>| json_set(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;$.c&#x27;</span>, <span class="hljs-string">&#x27;[true, false]&#x27;</span>) |<br>+-------------------------------------------------+<br>| &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-string">&quot;[true, false]&quot;</span>&#125;    |<br>+-------------------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br></code></pre></td></tr></table></figure>
<h4 id="JSON-REPLACE-json-doc-path-val-path-val-…">JSON_REPLACE(json_doc, path, val[, path, val] …)</h4>
<ul>
<li>替换已经存在的值。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">mysql&gt; set <span class="hljs-meta">@j</span> = <span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3]&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_replace</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;$.c&#x27;</span>, <span class="hljs-string">&#x27;[true, false]&#x27;</span>)</span></span>;<br>+-----------------------------------------------------+<br>| json_replace(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-number">10</span>, <span class="hljs-string">&#x27;$.c&#x27;</span>, <span class="hljs-string">&#x27;[true, false]&#x27;</span>) |<br>+-----------------------------------------------------+<br>| &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">10</span>, <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]&#125;                              |<br>+-----------------------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br></code></pre></td></tr></table></figure>
<h3 id="删除操作">删除操作</h3>
<h4 id="JSON-REMOVE-json-doc-path-path-…">JSON_REMOVE(json_doc, path[, path] …)</h4>
<ul>
<li>删除 JSON 文档指定位置的元素。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java">mysql&gt; set <span class="hljs-meta">@j</span> = <span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;: [2, 3]&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_remove</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>)</span></span>;<br>+------------------------+<br>| JSON_REMOVE(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>) |<br>+------------------------+<br>| &#123;<span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]&#125;          |<br>+------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; set @j </span>= <span class="hljs-string">&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;, &quot;e&quot;]&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_remove</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>)</span></span>;<br>+-------------------------+<br>| JSON_REMOVE(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>) |<br>+-------------------------+<br>| [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>]         |<br>+-------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_remove</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&#x27;$[2]&#x27;</span>)</span></span>;<br>+--------------------------------+<br>| JSON_REMOVE(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&#x27;$[2]&#x27;</span>) |<br>+--------------------------------+<br>| [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;d&quot;</span>]                     |<br>+--------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_remove</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&#x27;$[1]&#x27;</span>)</span></span>;<br>+--------------------------------+<br>| JSON_REMOVE(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>,<span class="hljs-string">&#x27;$[1]&#x27;</span>) |<br>+--------------------------------+<br>| [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;e&quot;</span>]                     |<br>+--------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br></code></pre></td></tr></table></figure>
<ul>
<li>最后一个查询，虽然两个 path 都是<code>'$[1]'</code>，但作用对象不一样，第一个 path 的作用对象是<code>'[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;, &quot;e&quot;]'</code>，第二个 path 的作用对象是删除了<code>'$[1]'</code>后的数组，即<code>'[&quot;a&quot;, &quot;d&quot;, &quot;e&quot;]'</code>。</li>
</ul>
<h2 id="创建索引">创建索引</h2>
<ul>
<li>同 TEXT，BLOB 字段一样，JSON 字段不允许直接创建索引。即使支持，实际意义也不大，因为我们一般是基于文档中的元素进行查询，很少会基于整个  JSON 文档。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t(c1 json, index (c1));<br>ERROR <span class="hljs-number">3152</span> (<span class="hljs-number">42000</span>): JSON <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;c1&#x27;</span> supports indexing <span class="hljs-keyword">only</span> via generated columns <span class="hljs-keyword">on</span> a specified JSON path.<br></code></pre></td></tr></table></figure>
<ul>
<li>对文档中的元素进行查询，就需要用到 MySQL 5.7 引入的虚拟列及函数索引。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"># C2 即虚拟列<br># index (c2) 对虚拟列添加索引。<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t ( c1 json, c2 <span class="hljs-type">varchar</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">as</span> (JSON_UNQUOTE(c1 <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> &quot;$.name&quot;)), index (c2) );<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t (c1) <span class="hljs-keyword">values</span>  (<span class="hljs-string">&#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span>), (<span class="hljs-string">&#x27;&#123;&quot;id&quot;: 2, &quot;name&quot;: &quot;b&quot;&#125;&#x27;</span>), (<span class="hljs-string">&#x27;&#123;&quot;id&quot;: 3, &quot;name&quot;: &quot;c&quot;&#125;&#x27;</span>), (<span class="hljs-string">&#x27;&#123;&quot;id&quot;: 4, &quot;name&quot;: &quot;d&quot;&#125;&#x27;</span>);<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> c2 <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;a&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span> <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> t     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> c2            <span class="hljs-operator">|</span> c2   <span class="hljs-operator">|</span> <span class="hljs-number">43</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> explain <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> c1<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.name&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;a&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span> <span class="hljs-operator">|</span> partitions <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>   <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span> <span class="hljs-operator">|</span> filtered <span class="hljs-operator">|</span> Extra <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> t     <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> c2            <span class="hljs-operator">|</span> c2   <span class="hljs-operator">|</span> <span class="hljs-number">43</span>      <span class="hljs-operator">|</span> const <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span>   <span class="hljs-number">100.00</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>  <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span>, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>可以看到，无论是使用虚拟列，还是文档中的元素来查询，都可以利用上索引。</li>
<li>注意，在创建虚拟列时需指定  JSON_UNQUOTE，将<code>c1 -&gt; &quot;$.name&quot;</code>的返回值转换为字符串。</li>
</ul>
<h2 id="如何将存储-JSON-字符串的字符字段升级为-JSON-字段">如何将存储 JSON 字符串的字符字段升级为 JSON 字段</h2>
<ul>
<li>在 MySQL 支持 JSON 类型之前，对于 JSON 文档，一般是以字符串的形式存储在字符类型（VARCHAR 或 TEXT）中。在 JSON 类型出来之后，如何将这些字符字段升级为 JSON 字段呢？</li>
<li>为方便演示，这里首先构建测试数据。</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog">create <span class="hljs-keyword">table</span> t (id <span class="hljs-keyword">int</span> auto_increment primary key, c1 text);<br><br>insert into t (c1) values (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;b&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;c&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;d&quot;</span>&#125;&#x27;);<br></code></pre></td></tr></table></figure>
<ul>
<li>注意，最后一个文档有问题，不是合格的 JSON 文档。</li>
<li>如果使用 DDL 直接修改字段的数据类型，会报错。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t modify c1 json;<br>ERROR <span class="hljs-number">3140</span> (<span class="hljs-number">22032</span>): Invalid JSON text: &quot;Missing a colon after a name of object member.&quot; <span class="hljs-keyword">at</span> position <span class="hljs-number">5</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">value</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;#sql-7e1c_1f6.c1&#x27;</span>.<br></code></pre></td></tr></table></figure>
<ol>
<li>使用 json_valid 函数找出不满足 JSON 格式要求的文档。</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp">mysql&gt; <span class="hljs-keyword">select</span> * <span class="hljs-function"><span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> <span class="hljs-title">json_valid</span>(<span class="hljs-params">c1</span>)</span> = <span class="hljs-number">0</span>;<br>+----+---------------------+<br>| id | c1                  |<br>+----+---------------------+<br>|  <span class="hljs-number">4</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;d&quot;</span>&#125; |<br>+----+---------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-keyword">in</span> <span class="hljs-title">set</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)</span><br></code></pre></td></tr></table></figure>
<ol start="2">
<li>处理不满足 JSON 格式要求的文档。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> update t <span class="hljs-keyword">set</span> c1<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#123;&quot;id&quot;: &quot;4&quot;, &quot;name&quot;: &quot;d&quot;&#125;&#x27;</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">4</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-type">row</span> affected (<span class="hljs-number">0.01</span> sec)<br><span class="hljs-keyword">Rows</span> matched: <span class="hljs-number">1</span>  Changed: <span class="hljs-number">1</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>将 TEXT 字段修改为 JSON 字段。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> json_valid(c1) <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">Empty</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t modify c1 json;<br>Query OK, <span class="hljs-number">4</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.13</span> sec)<br>Records: <span class="hljs-number">4</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<h2 id="使用-JSON-时的注意事项">使用 JSON 时的注意事项</h2>
<ol>
<li>
<p>在 MySQL 8.0.13 之前，不允许对 BLOB，TEXT，GEOMETRY，JSON 字段设置默认值。从 MySQL 8.0.13 开始，取消了这个限制。</p>
<p>设置时，注意默认值需通过小括号<code>()</code>括起来，否则的话，还是会提示 JSON 字段不允许设置默认值。</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t(c1 json <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> (<span class="hljs-string">&#x27;&#x27;</span>));<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.03</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t(c1 json <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;&#x27;</span>);<br>ERROR <span class="hljs-number">1101</span> (<span class="hljs-number">42000</span>): <span class="hljs-type">BLOB</span>, TEXT, GEOMETRY <span class="hljs-keyword">or</span> JSON <span class="hljs-keyword">column</span> <span class="hljs-string">&#x27;c1&#x27;</span> can<span class="hljs-string">&#x27;t have a default value</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>不允许直接创建索引，可创建函数索引。</p>
</li>
<li>
<p>JSON 列的最大大小和 LONGBLOB（LONGTEXT）一样，都是 4G。</p>
</li>
<li>
<p>插入时，单个文档的大小受到 max_allowed_packet 的限制，该参数最大是 1G。</p>
</li>
</ol>
<h2 id="Partial-Updates">Partial Updates</h2>
<ul>
<li>在 MySQL 5.7 中，对 JSON 文档进行更新，其处理策略是，删除旧的文档，再插入新的文档。即使这个修改很微小，只涉及几个字节，也会替换掉整个文档。很显然，这种处理方式的效率较为低下。</li>
<li>在 MySQL 8.0 中，针对 JSON 文档，引入了一项新的特性-Partial Updates（部分更新），支持 JSON 文档的原地更新。得益于这个特性，JSON 文档的处理性能得到了极大提升。</li>
</ul>
<h3 id="使用-Partial-Updates-的条件">使用 Partial Updates 的条件</h3>
<ul>
<li>为方便阐述，这里先构造测试数据。</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">create</span> table t (id int auto_increment primary key, c1 json);<br><br><span class="hljs-title">insert</span> into t (c1) values  (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;b&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;c&quot;</span>&#125;&#x27;), (&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;d&quot;</span>&#125;&#x27;);<br><br><span class="hljs-title">mysql</span>&gt; select * from t;<br>+<span class="hljs-comment">----+------------------------+</span><br>| id | c1                     |<br>+<span class="hljs-comment">----+------------------------+</span><br>|  <span class="hljs-number">1</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125; |<br>|  <span class="hljs-number">2</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;b&quot;</span>&#125; |<br>|  <span class="hljs-number">3</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;c&quot;</span>&#125; |<br>|  <span class="hljs-number">4</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;d&quot;</span>&#125; |<br>+<span class="hljs-comment">----+------------------------+</span><br><span class="hljs-number">4</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>使用 Partial Updates 需满足以下条件：</li>
</ul>
<ol>
<li>
<p>被更新的列是 JSON 类型。</p>
</li>
<li>
<p>使用 JSON_SET，JSON_REPLACE，JSON_REMOVE 进行 UPDATE 操作，如，</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">update t <span class="hljs-built_in">set</span> c1=json_remove(c1,<span class="hljs-string">&#x27;$.id&#x27;</span>) <span class="hljs-built_in">where</span> id=1;<br></code></pre></td></tr></table></figure>
<p>不使用这三个函数，而显式赋值，就不会进行部分更新，如，</p>
 <figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs swift">update t <span class="hljs-keyword">set</span> c1<span class="hljs-operator">=</span>&#x27;&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125;&#x27; <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>输入列和目标列必须是同一列，如，</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">update t <span class="hljs-built_in">set</span> c1=json_replace(c1,<span class="hljs-string">&#x27;$.id&#x27;</span>,10) <span class="hljs-built_in">where</span> id=1;<br></code></pre></td></tr></table></figure>
<p>否则的话，就不会进行部分更新，如，</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">update t <span class="hljs-built_in">set</span> c1=json_replace(c2,<span class="hljs-string">&#x27;$.id&#x27;</span>,10) <span class="hljs-built_in">where</span> id=1;<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>变更前后，JSON 文档的空间使用不会增加。</p>
</li>
</ol>
<ul>
<li>关于最后一个条件，我们看看下面这个示例。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs csharp">mysql&gt; <span class="hljs-keyword">select</span> *,json_storage_size(c1),json_storage_free(c1) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;<br>+----+------------------------+-----------------------+-----------------------+<br>| id | c1                     | json_storage_size(c1) | json_storage_free(c1) |<br>+----+------------------------+-----------------------+-----------------------+<br>|  <span class="hljs-number">1</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125; |                    <span class="hljs-number">27</span> |                     <span class="hljs-number">0</span> |<br>+----+------------------------+-----------------------+-----------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-keyword">in</span> <span class="hljs-title">set</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; update t <span class="hljs-keyword">set</span> c1</span>=json_remove(c1,<span class="hljs-string">&#x27;$.id&#x27;</span>) <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.01</span> sec</span>)</span><br><span class="hljs-function">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; <span class="hljs-keyword">select</span> *,<span class="hljs-title">json_storage_size</span>(<span class="hljs-params">c1</span>),<span class="hljs-title">json_storage_free</span>(<span class="hljs-params">c1</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id</span>=<span class="hljs-number">1</span>;<br>+----+---------------+-----------------------+-----------------------+<br>| id | c1            | json_storage_size(c1) | json_storage_free(c1) |<br>+----+---------------+-----------------------+-----------------------+<br>|  <span class="hljs-number">1</span> | &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125; |                    <span class="hljs-number">27</span> |                     <span class="hljs-number">9</span> |<br>+----+---------------+-----------------------+-----------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-keyword">in</span> <span class="hljs-title">set</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; update t <span class="hljs-keyword">set</span> c1</span>=json_set(c1,<span class="hljs-string">&#x27;$.id&#x27;</span>,<span class="hljs-number">3306</span>) <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.01</span> sec</span>)</span><br><span class="hljs-function">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; <span class="hljs-keyword">select</span> *,<span class="hljs-title">json_storage_size</span>(<span class="hljs-params">c1</span>),<span class="hljs-title">json_storage_free</span>(<span class="hljs-params">c1</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id</span>=<span class="hljs-number">1</span>;<br>+----+---------------------------+-----------------------+-----------------------+<br>| id | c1                        | json_storage_size(c1) | json_storage_free(c1) |<br>+----+---------------------------+-----------------------+-----------------------+<br>|  <span class="hljs-number">1</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3306</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125; |                    <span class="hljs-number">27</span> |                     <span class="hljs-number">0</span> |<br>+----+---------------------------+-----------------------+-----------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-keyword">in</span> <span class="hljs-title">set</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)</span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; update t <span class="hljs-keyword">set</span> c1</span>=json_set(c1,<span class="hljs-string">&#x27;$.id&#x27;</span>,<span class="hljs-string">&#x27;mysql&#x27;</span>) <span class="hljs-keyword">where</span> id=<span class="hljs-number">1</span>;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-title">affected</span> (<span class="hljs-params"><span class="hljs-number">0.01</span> sec</span>)</span><br><span class="hljs-function">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; <span class="hljs-keyword">select</span> *,<span class="hljs-title">json_storage_size</span>(<span class="hljs-params">c1</span>),<span class="hljs-title">json_storage_free</span>(<span class="hljs-params">c1</span>) <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> id</span>=<span class="hljs-number">1</span>;<br>+----+------------------------------+-----------------------+-----------------------+<br>| id | c1                           | json_storage_size(c1) | json_storage_free(c1) |<br>+----+------------------------------+-----------------------+-----------------------+<br>|  <span class="hljs-number">1</span> | &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;mysql&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;a&quot;</span>&#125; |                    <span class="hljs-number">33</span> |                     <span class="hljs-number">0</span> |<br>+----+------------------------------+-----------------------+-----------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row <span class="hljs-keyword">in</span> <span class="hljs-title">set</span> (<span class="hljs-params"><span class="hljs-number">0.00</span> sec</span>)</span><br></code></pre></td></tr></table></figure>
<ul>
<li>示例中，用到了两个函数：JSON_STORAGE_SIZE 和 JSON_STORAGE_FREE ，前者用来获取 JSON 文档的空间使用情况，后者用来获取 JSON 文档在执行原地更新后的空间释放情况。</li>
<li>这里一共执行了三次 UPDATE 操作，前两次是原地更新，第三次不是。同样是 JSON_SET 操作，为什么第一次是原地更新，而第二次不是呢？</li>
<li>因为第一次的 JSON_SET 复用了 JSON_REMOVE 释放的空间。而第二次的 JSON_SET 执行的是更新操作，且 ‘mysql’ 比 3306 需要更多的存储空间。</li>
</ul>
<h3 id="如何在-binlog-中开启-Partial">如何在 binlog 中开启 Partial</h3>
<ul>
<li>Partial Updates 不仅仅适用于存储引擎层，还可用于主从复制场景。</li>
<li>主从复制开启 Partial Updates，只需将参数 binlog_row_value_options（默认为空）设置为 PARTIAL_JSON。</li>
<li>下面具体来看看，同一个 UPDATE 操作，开启和不开启 Partial Updates，在 binlog 中的记录有何区别。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">update t <span class="hljs-built_in">set</span> c1=json_replace(c1,<span class="hljs-string">&#x27;$.id&#x27;</span>,10) <span class="hljs-built_in">where</span> id=1;<br></code></pre></td></tr></table></figure>
<ul>
<li>不开启。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## UPDATE `slowtech`.`t`</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## WHERE</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @1=1</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @2=&#x27;&#123;&quot;id&quot;: &quot;1&quot;, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## SET</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @1=1</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @2=&#x27;&#123;&quot;id&quot;: 10, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span></span><br></code></pre></td></tr></table></figure>
<ul>
<li>开启。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## UPDATE `slowtech`.`t`</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## WHERE</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @1=1</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @2=&#x27;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;a&quot;&#125;&#x27;</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">## SET</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @1=1</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##   @2=JSON_REPLACE(@2, &#x27;$.id&#x27;, 10)</span></span><br></code></pre></td></tr></table></figure>
<ul>
<li>对比 binlog 的内容，可以看到，不开启，无论是修改前的镜像（before_image）还是修改后的镜像（after_image），记录的都是完整文档。而开启后，对于修改后的镜像，记录的是命令，而不是完整文档，这样可节省近一半的空间。</li>
<li>在将 binlog_row_value_options 设置为 PARTIAL_JSON 后，对于可使用 Partial Updates 的操作，在 binlog 中，不再通过 ROWS_EVENT 来记录，而是新增了一个 PARTIAL_UPDATE_ROWS_EVENT 的事件类型。</li>
<li>需要注意的是，binlog 中使用 Partial Updates，只需满足存储引擎层使用 Partial Updates 的前三个条件，无需考虑变更前后，JSON 文档的空间使用是否会增加。</li>
</ul>
<h3 id="关于-Partial-Updates-的性能测试">关于 Partial Updates 的性能测试</h3>
<ul>
<li>以 MySQL 5.7.36 的查询时间作为基准：
<ol>
<li>MySQL 8.0 只开启存储引擎层的 Partial Updates，查询时间比 MySQL 5.7 快 1.94 倍。</li>
<li>MySQL 8.0 同时开启存储引擎层和 binlog 中的 Partial Updates，查询时间比 MySQL 5.7 快 4.87 倍。</li>
<li>如果在 2 的基础上，同时将 binlog_row_image 设置为 MINIMAL，查询时间更是比 MySQL 5.7 快 102.22 倍。</li>
</ol>
</li>
<li>当然，在生产环境，我们一般很少将 binlog_row_image 设置为 MINIMAL。但即使如此，只开启存储引擎层和 binlog 中的 Partial Updates，查询时间也比 MySQL 5.7 快 4.87 倍，性能提升还是比较明显的。</li>
</ul>
<h2 id="其它-JSON-函数">其它 JSON 函数</h2>
<h3 id="查询相关">查询相关</h3>
<h4 id="JSON-CONTAINS-target-candidate-path">JSON_CONTAINS(target, candidate[, path])</h4>
<ul>
<li>判断 target 文档是否包含 candidate 文档，如果包含，则返回 1，否则是 0。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-variable">@j</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#123;&quot;a&quot;: [1, 2], &quot;b&quot;: 3, &quot;c&quot;: &#123;&quot;d&quot;: 4&#125;&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_contains(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>),json_contains(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;$.b&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-------------------------------+</span><br><span class="hljs-operator">|</span> json_contains(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>) <span class="hljs-operator">|</span> json_contains(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;$.b&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-------------------------------+</span><br><span class="hljs-operator">|</span>                             <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                             <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_contains(<span class="hljs-variable">@j</span>,<span class="hljs-string">&#x27;&#123;&quot;d&quot;: 4&#125;&#x27;</span>,<span class="hljs-string">&#x27;$.a&#x27;</span>),json_contains(<span class="hljs-variable">@j</span>,<span class="hljs-string">&#x27;&#123;&quot;d&quot;: 4&#125;&#x27;</span>,<span class="hljs-string">&#x27;$.c&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+------------------------------------+</span><br><span class="hljs-operator">|</span> json_contains(<span class="hljs-variable">@j</span>,<span class="hljs-string">&#x27;&#123;&quot;d&quot;: 4&#125;&#x27;</span>,<span class="hljs-string">&#x27;$.a&#x27;</span>) <span class="hljs-operator">|</span> json_contains(<span class="hljs-variable">@j</span>,<span class="hljs-string">&#x27;&#123;&quot;d&quot;: 4&#125;&#x27;</span>,<span class="hljs-string">&#x27;$.c&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+------------------------------------+</span><br><span class="hljs-operator">|</span>                                  <span class="hljs-number">0</span> <span class="hljs-operator">|</span>                                  <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------+------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-CONTAINS-PATH-json-doc-one-or-all-path-path-…">JSON_CONTAINS_PATH(json_doc, one_or_all, path[, path] …)</h4>
<ul>
<li>判断指定的 path 是否存在，存在，则返回 1，否则是 0。</li>
<li>函数中的 one_or_all 可指定 one 或 all，one 是任意一个路径存在就返回 1，all 是所有路径都存在才返回 1。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-variable">@j</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&#123;&quot;a&quot;: [1, 2], &quot;b&quot;: 3, &quot;c&quot;: &#123;&quot;d&quot;: 4&#125;&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-string">&#x27;$.e&#x27;</span>), json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-string">&#x27;$.e&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+---------------------------------------------+</span><br><span class="hljs-operator">|</span> json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-string">&#x27;$.e&#x27;</span>) <span class="hljs-operator">|</span> json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>, <span class="hljs-string">&#x27;$.e&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+---------------------------------------------+</span><br><span class="hljs-operator">|</span>                                           <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                                           <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+---------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;$.c.d&#x27;</span>),json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;$.a.d&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------+----------------------------------------+</span><br><span class="hljs-operator">|</span> json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;$.c.d&#x27;</span>) <span class="hljs-operator">|</span> json_contains_path(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;$.a.d&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------+----------------------------------------+</span><br><span class="hljs-operator">|</span>                                      <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                                      <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------+----------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-SEARCH-json-doc-one-or-all-search-str-escape-char-path-…">JSON_SEARCH(json_doc, one_or_all, search_str[, escape_char[, path] …])</h4>
<ul>
<li>返回某个字符串（search_str）在 JSON 文档中的位置，其中：
<ul>
<li>one_or_all：匹配的次数，one 是只匹配一次，all 是匹配所有。如果匹配到多个，结果会以数组的形式返回。</li>
<li>search_str：子串，支持模糊匹配：<code>%</code> 和<code> _</code> 。</li>
<li>escape_char：转义符，如果该参数不填或为 NULL，则取默认转义符<code>\</code>。</li>
<li>path：查找路径。</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">set</span> <span class="hljs-variable">@j</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;[&quot;abc&quot;, [&#123;&quot;k&quot;: &quot;10&quot;&#125;, &quot;def&quot;], &#123;&quot;x&quot;:&quot;abc&quot;&#125;, &#123;&quot;y&quot;:&quot;bcd&quot;&#125;]&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>),json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>),json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;ghi&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-------------------------------+-------------------------------+</span><br><span class="hljs-operator">|</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>) <span class="hljs-operator">|</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;abc&#x27;</span>) <span class="hljs-operator">|</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;ghi&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-------------------------------+-------------------------------+</span><br><span class="hljs-operator">|</span> &quot;$[0]&quot;                        <span class="hljs-operator">|</span> [&quot;$[0]&quot;, &quot;$[2].x&quot;]            <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>                          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------+-------------------------------+-------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;%b%&#x27;</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>), json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;%b%&#x27;</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;$[3]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+---------------------------------------------+</span><br><span class="hljs-operator">|</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;%b%&#x27;</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>) <span class="hljs-operator">|</span> json_search(<span class="hljs-variable">@j</span>, <span class="hljs-string">&#x27;all&#x27;</span>, <span class="hljs-string">&#x27;%b%&#x27;</span>, <span class="hljs-keyword">NULL</span>, <span class="hljs-string">&#x27;$[3]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+---------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>                                        <span class="hljs-operator">|</span> &quot;$[3].y&quot;                                    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------------+---------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-KEYS-json-doc-path">JSON_KEYS(json_doc[, path])</h4>
<ul>
<li>返回 JSON 文档最外层的 key，如果指定了 path，则返回该 path 对应元素最外层的 key。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_keys(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+</span><br><span class="hljs-operator">|</span> json_keys(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+</span><br><span class="hljs-operator">|</span> [&quot;a&quot;, &quot;b&quot;]                            <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_keys(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.b&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------+</span><br><span class="hljs-operator">|</span> json_keys(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.b&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------+</span><br><span class="hljs-operator">|</span> [&quot;c&quot;]                                        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-VALUE-json-doc-path">JSON_VALUE(json_doc, path)</h4>
<ul>
<li>8.0.21 引入的，从 JSON 文档提取指定路径（path）的元素。</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">JSON_VALUE(json_doc,</span> <span class="hljs-string">path</span> [<span class="hljs-string">RETURNING</span> <span class="hljs-string">type</span>] [<span class="hljs-string">on_empty</span>] [<span class="hljs-string">on_error</span>]<span class="hljs-string">)</span><br><br><span class="hljs-attr">on_empty:</span><br>    &#123;<span class="hljs-literal">NULL</span> <span class="hljs-string">|</span> <span class="hljs-string">ERROR</span> <span class="hljs-string">|</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-string">value</span>&#125; <span class="hljs-string">ON</span> <span class="hljs-string">EMPTY</span><br><br><span class="hljs-attr">on_error:</span><br>    &#123;<span class="hljs-literal">NULL</span> <span class="hljs-string">|</span> <span class="hljs-string">ERROR</span> <span class="hljs-string">|</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-string">value</span>&#125; <span class="hljs-string">ON</span> <span class="hljs-string">ERROR</span><br></code></pre></td></tr></table></figure>
<ul>
<li>RETURNING type：返回值的类型，不指定，则默认是 VARCHAR(512)。不指定字符集，则默认是 utf8mb4，且区分大小写。</li>
<li>on_empty：如果指定路径没有值，会触发 on_empty 子句， 默认是返回 NULL，也可指定 ERROR 抛出错误，或者通过 DEFAULT value 返回默认值。</li>
<li>on_error：三种情况下会触发 on_error 子句：从数组或对象中提取元素时，会解析到多个值；类型转换错误，譬如将 “abc” 转换为 unsigned 类型；值被 truncate 了。默认是返回 NULL。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">json_value</span>(<span class="hljs-string">&#x27;&#123;&quot;item&quot;: &quot;shoes&quot;, &quot;price&quot;: &quot;49.95&quot;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.item&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">json_value</span>(<span class="hljs-string">&#x27;&#123;&quot;item&quot;: &quot;shoes&quot;, &quot;price&quot;: &quot;49.95&quot;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.item&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------+</span><br><span class="hljs-operator">|</span> shoes                                                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">json_value</span>(<span class="hljs-string">&#x27;&#123;&quot;item&quot;: &quot;shoes&quot;, &quot;price&quot;: &quot;49.95&quot;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.price&#x27;</span> returning <span class="hljs-type">decimal</span>(<span class="hljs-number">4</span>,<span class="hljs-number">2</span>)) <span class="hljs-keyword">as</span> price;<br><span class="hljs-operator">+</span><span class="hljs-comment">-------+</span><br><span class="hljs-operator">|</span> price <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">49.95</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">json_value</span>(<span class="hljs-string">&#x27;&#123;&quot;item&quot;: &quot;shoes&quot;, &quot;price&quot;: &quot;49.95&quot;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.price1&#x27;</span> error <span class="hljs-keyword">on</span> <span class="hljs-keyword">empty</span>);<br>ERROR <span class="hljs-number">3966</span> (<span class="hljs-number">22035</span>): <span class="hljs-keyword">No</span> <span class="hljs-keyword">value</span> was found <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;json_value&#x27;</span> <span class="hljs-keyword">on</span> the specified path.<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">json_value</span>(<span class="hljs-string">&#x27;[1, 2, 3]&#x27;</span>, <span class="hljs-string">&#x27;$[1 to 2]&#x27;</span> error <span class="hljs-keyword">on</span> error);<br>ERROR <span class="hljs-number">3967</span> (<span class="hljs-number">22034</span>): More than <span class="hljs-keyword">one</span> <span class="hljs-keyword">value</span> was found <span class="hljs-keyword">by</span> <span class="hljs-string">&#x27;json_value&#x27;</span> <span class="hljs-keyword">on</span> the specified path.<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">json_value</span>(<span class="hljs-string">&#x27;&#123;&quot;item&quot;: &quot;shoes&quot;, &quot;price&quot;: &quot;49.95&quot;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.item&#x27;</span> returning unsigned error <span class="hljs-keyword">on</span> error) <span class="hljs-keyword">as</span> price;<br>ERROR <span class="hljs-number">1690</span> (<span class="hljs-number">22003</span>): UNSIGNED <span class="hljs-keyword">value</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">out</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">range</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;json_value&#x27;</span><br></code></pre></td></tr></table></figure>
<h4 id="value-MEMBER-OF-json-array">value MEMBER OF(json_array)</h4>
<ul>
<li>判断 value 是否是 JSON 数组的一个元素，如果是，则返回 1，否则是 0。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-number">17</span> <span class="hljs-keyword">member</span> <span class="hljs-keyword">of</span>(<span class="hljs-string">&#x27;[23, &quot;abc&quot;, 17, &quot;ab&quot;, 10]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-number">17</span> <span class="hljs-keyword">member</span> <span class="hljs-keyword">of</span>(<span class="hljs-string">&#x27;[23, &quot;abc&quot;, 17, &quot;ab&quot;, 10]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------+</span><br><span class="hljs-operator">|</span>                                         <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">cast</span>(<span class="hljs-string">&#x27;[4,5]&#x27;</span> <span class="hljs-keyword">as</span> json) <span class="hljs-keyword">member</span> <span class="hljs-keyword">of</span>(<span class="hljs-string">&#x27;[[3,4],[4,5]]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">cast</span>(<span class="hljs-string">&#x27;[4,5]&#x27;</span> <span class="hljs-keyword">as</span> json) <span class="hljs-keyword">member</span> <span class="hljs-keyword">of</span>(<span class="hljs-string">&#x27;[[3,4],[4,5]]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------+</span><br><span class="hljs-operator">|</span>                                                <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-OVERLAPS-json-doc1-json-doc2">JSON_OVERLAPS(json_doc1, json_doc2)</h4>
<ul>
<li>MySQL 8.0.17 引入的，用来比较两个 JSON 文档是否有相同的键值对或数组元素，如果有，则返回 1，否则是 0。如果两个参数都是标量，则判断这两个标量是否相等。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_overlaps(<span class="hljs-string">&#x27;[1,3,5,7]&#x27;</span>, <span class="hljs-string">&#x27;[2,5,7]&#x27;</span>),json_overlaps(<span class="hljs-string">&#x27;[1,3,5,7]&#x27;</span>, <span class="hljs-string">&#x27;[2,6,8]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+---------------------------------------+</span><br><span class="hljs-operator">|</span> json_overlaps(<span class="hljs-string">&#x27;[1,3,5,7]&#x27;</span>, <span class="hljs-string">&#x27;[2,5,7]&#x27;</span>) <span class="hljs-operator">|</span> json_overlaps(<span class="hljs-string">&#x27;[1,3,5,7]&#x27;</span>, <span class="hljs-string">&#x27;[2,6,8]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+---------------------------------------+</span><br><span class="hljs-operator">|</span>                                     <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                                     <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------------+---------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_overlaps(<span class="hljs-string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;c&quot;:3,&quot;d&quot;:4,&quot;b&quot;:2&#125;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_overlaps(<span class="hljs-string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;c&quot;:3,&quot;d&quot;:4,&quot;b&quot;:2&#125;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------+</span><br><span class="hljs-operator">|</span>                                                     <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_overlaps(<span class="hljs-string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;c&quot;:3,&quot;d&quot;:4,&quot;b&quot;:10&#125;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_overlaps(<span class="hljs-string">&#x27;&#123;&quot;a&quot;:1,&quot;b&quot;:2&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;c&quot;:3,&quot;d&quot;:4,&quot;b&quot;:10&#125;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------------+</span><br><span class="hljs-operator">|</span>                                                      <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_overlaps(<span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>),json_overlaps(<span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------------------------+</span><br><span class="hljs-operator">|</span> json_overlaps(<span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>) <span class="hljs-operator">|</span> json_overlaps(<span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------------------------+</span><br><span class="hljs-operator">|</span>                       <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                       <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-------------------------+-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>从 MySQL 8.0.17 开始，InnoDB 支持多值索引，可用在 JSON 数组中。当我们使用 JSON_CONTAINS、MEMBER OF、JSON_OVERLAPS 进行数组相关的操作时，可使用多值索引来加快查询。</li>
</ul>
<h3 id="修改相关">修改相关</h3>
<h4 id="JSON-ARRAY-APPEND-json-doc-path-val-path-val-…">JSON_ARRAY_APPEND(json_doc, path, val[, path, val] …)</h4>
<ul>
<li>向数组指定位置追加元素。如果指定 path 不存在，则不添加。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">mysql&gt; set <span class="hljs-meta">@j</span> = <span class="hljs-string">&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;], &quot;d&quot;]&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_array_append</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;$[1][0]&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;$[3]&#x27;</span>, <span class="hljs-number">3</span>)</span></span>;<br>+-----------------------------------------------------------+<br>| json_array_append(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;$[1][0]&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;$[3]&#x27;</span>, <span class="hljs-number">3</span>) |<br>+-----------------------------------------------------------+<br>| [[<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>], [[<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>], <span class="hljs-string">&quot;c&quot;</span>], <span class="hljs-string">&quot;d&quot;</span>]                          |<br>+-----------------------------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; set @j </span>= <span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: [2, 3], &quot;c&quot;: 4&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_array_append</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.b&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;$&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>)</span></span>;<br>+---------------------------------------------+<br>| json_array_append(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$.b&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;$&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>) |<br>+---------------------------------------------+<br>| [&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>: [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-string">&quot;x&quot;</span>], <span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">4</span>&#125;, <span class="hljs-string">&quot;z&quot;</span>]   |<br>+---------------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br></code></pre></td></tr></table></figure>
<h4 id="JSON-ARRAY-INSERT-json-doc-path-val-path-val-…">JSON_ARRAY_INSERT(json_doc, path, val[, path, val] …)</h4>
<ul>
<li>向数组指定位置插入元素。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java">mysql&gt; set <span class="hljs-meta">@j</span> = <span class="hljs-string">&#x27;[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;],&#123;&quot;d&quot;:&quot;e&quot;&#125;]&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_array_insert</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>, <span class="hljs-number">1</span>)</span></span>;<br>+----------------------------------+<br>| json_array_insert(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[0]&#x27;</span>, <span class="hljs-number">1</span>) |<br>+----------------------------------+<br>| [<span class="hljs-number">1</span>, <span class="hljs-string">&quot;a&quot;</span>, [<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>], &#123;<span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-string">&quot;e&quot;</span>&#125;] |<br>+----------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_array_insert</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>, cast(<span class="hljs-string">&#x27;[1,2]&#x27;</span> as json)</span>)</span>;<br>+------------------------------------------------------+<br>| json_array_insert(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[1]&#x27;</span>, cast(<span class="hljs-string">&#x27;[1,2]&#x27;</span> as json)) |<br>+------------------------------------------------------+<br>| [<span class="hljs-string">&quot;a&quot;</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>], &#123;<span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-string">&quot;e&quot;</span>&#125;]                |<br>+------------------------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_array_insert</span><span class="hljs-params">(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[5]&#x27;</span>, <span class="hljs-number">2</span>)</span></span>;<br>+----------------------------------+<br>| json_array_insert(<span class="hljs-meta">@j</span>, <span class="hljs-string">&#x27;$[5]&#x27;</span>, <span class="hljs-number">2</span>) |<br>+----------------------------------+<br>| [<span class="hljs-string">&quot;a&quot;</span>, [<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>], &#123;<span class="hljs-string">&quot;d&quot;</span>: <span class="hljs-string">&quot;e&quot;</span>&#125;, <span class="hljs-number">2</span>] |<br>+----------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br></code></pre></td></tr></table></figure>
<h4 id="JSON-MERGE-PATCH-json-doc-json-doc-json-doc-…">JSON_MERGE_PATCH(json_doc, json_doc[, json_doc] …)</h4>
<ul>
<li>MySQL 8.0.3 引入的，用来合并多个 JSON 文档。其合并规则如下：
<ol>
<li>如果两个文档不全是 JSON 对象，则合并后的结果是第二个文档。</li>
<li>如果两个文档都是 JSON 对象，且不存在着同名 KEY，则合并后的文档包括两个文档的所有元素，如果存在着同名 KEY，则第二个文档的值会覆盖第一个。</li>
</ol>
</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs lua">mysql&gt; <span class="hljs-built_in">select</span> json_merge_patch(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;[3, 4]&#x27;</span>), json_merge_patch(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;a&quot;: 123&#125;&#x27;</span>);<br>+<span class="hljs-comment">--------------------------------------+------------------------------------------+</span><br>| json_merge_patch(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;[3, 4]&#x27;</span>) | json_merge_patch(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;a&quot;: 123&#125;&#x27;</span>) |<br>+<span class="hljs-comment">--------------------------------------+------------------------------------------+</span><br>| [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]                               | &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">123</span>&#125;                               |<br>+<span class="hljs-comment">--------------------------------------+------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_merge_patch(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;b&quot;: 2&#125;&#x27;</span>),json_merge_patch(<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;:2 &#125;&#x27;</span>,<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 3, &quot;c&quot;:4 &#125;&#x27;</span>);<br>+<span class="hljs-comment">------------------------------------------+-----------------------------------------------------------+</span><br>| json_merge_patch(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;b&quot;: 2&#125;&#x27;</span>) | json_merge_patch(<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;:2 &#125;&#x27;</span>,<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 3, &quot;c&quot;:4 &#125;&#x27;</span>) |<br>+<span class="hljs-comment">------------------------------------------+-----------------------------------------------------------+</span><br>| &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;                         | &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">4</span>&#125;                                  |<br>+<span class="hljs-comment">------------------------------------------+-----------------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br># 如果第二个文档存在 null 值，文档合并后不会输出对应的 KEY。<br>mysql&gt; <span class="hljs-built_in">select</span> json_merge_patch(<span class="hljs-string">&#x27;&#123;&quot;a&quot;:1, &quot;b&quot;:2&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;a&quot;:3, &quot;b&quot;:null&#125;&#x27;</span>);<br>+<span class="hljs-comment">---------------------------------------------------------+</span><br>| json_merge_patch(<span class="hljs-string">&#x27;&#123;&quot;a&quot;:1, &quot;b&quot;:2&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;a&quot;:3, &quot;b&quot;:null&#125;&#x27;</span>) |<br>+<span class="hljs-comment">---------------------------------------------------------+</span><br>| &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">3</span>&#125;                                                |<br>+<span class="hljs-comment">---------------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-MERGE-PRESERVE-json-doc-json-doc-json-doc-…">JSON_MERGE_PRESERVE(json_doc, json_doc[, json_doc] …)</h4>
<ul>
<li>MySQL 8.0.3 引入的，用来代替 JSON_MERGE。也是用来合并文档，但合并规则与 JSON_MERGE_PATCH 有所不同。
<ol>
<li>两个文档中，只要有一个文档是数组，则另外一个文档会合并到该数组中。</li>
<li>两个文档都是 JSON 对象，若存在着同名 KEY ，第二个文档并不会覆盖第一个，而是会将值 append 到第一个文档中。</li>
</ol>
</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs lua">mysql&gt; <span class="hljs-built_in">select</span> json_merge_preserve(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>),json_merge_preserve(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;[3, 4]&#x27;</span>);<br>+<span class="hljs-comment">------------------------------+-----------------------------------------+</span><br>| json_merge_preserve(<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-string">&#x27;2&#x27;</span>) | json_merge_preserve(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;[3, 4]&#x27;</span>) |<br>+<span class="hljs-comment">------------------------------+-----------------------------------------+</span><br>| [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]                       | [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]                            |<br>+<span class="hljs-comment">------------------------------+-----------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_merge_preserve(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;a&quot;: 123&#125;&#x27;</span>), json_merge_preserve(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 123&#125;&#x27;</span>, <span class="hljs-string">&#x27;[3,4]&#x27;</span>);<br>+<span class="hljs-comment">---------------------------------------------+--------------------------------------------+</span><br>| json_merge_preserve(<span class="hljs-string">&#x27;[1, 2]&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;a&quot;: 123&#125;&#x27;</span>) | json_merge_preserve(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 123&#125;&#x27;</span>, <span class="hljs-string">&#x27;[3,4]&#x27;</span>) |<br>+<span class="hljs-comment">---------------------------------------------+--------------------------------------------+</span><br>| [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">123</span>&#125;]                          | [&#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">123</span>&#125;, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]                         |<br>+<span class="hljs-comment">---------------------------------------------+--------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_merge_preserve(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;b&quot;: 2&#125;&#x27;</span>), json_merge_preserve(<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;:2 &#125;&#x27;</span>,<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 3, &quot;c&quot;:4 &#125;&#x27;</span>);<br>+<span class="hljs-comment">---------------------------------------------+--------------------------------------------------------------+</span><br>| json_merge_preserve(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1&#125;&#x27;</span>, <span class="hljs-string">&#x27;&#123;&quot;b&quot;: 2&#125;&#x27;</span>) | json_merge_preserve(<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 1, &quot;b&quot;:2 &#125;&#x27;</span>,<span class="hljs-string">&#x27;&#123; &quot;a&quot;: 3, &quot;c&quot;:4 &#125;&#x27;</span>) |<br>+<span class="hljs-comment">---------------------------------------------+--------------------------------------------------------------+</span><br>| &#123;<span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>&#125;                            | &#123;<span class="hljs-string">&quot;a&quot;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>], <span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;c&quot;</span>: <span class="hljs-number">4</span>&#125;                                |<br>+<span class="hljs-comment">---------------------------------------------+--------------------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-MERGE-json-doc-json-doc-json-doc-…">JSON_MERGE(json_doc, json_doc[, json_doc] …)</h4>
<ul>
<li>与 JSON_MERGE_PRESERVE 作用一样，从 MySQL 8.0.3 开始不建议使用，后续会移除。</li>
</ul>
<h3 id="其它辅助函数">其它辅助函数</h3>
<h4 id="JSON-QUOTE-string">JSON_QUOTE(string)</h4>
<ul>
<li>生成有效的 JSON 字符串，主要是对一些特殊字符（如双引号）进行转义。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_quote(<span class="hljs-string">&#x27;null&#x27;</span>), json_quote(<span class="hljs-string">&#x27;&quot;null&quot;&#x27;</span>), json_quote(<span class="hljs-string">&#x27;[1, 2, 3]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+----------------------+-------------------------+</span><br><span class="hljs-operator">|</span> json_quote(<span class="hljs-string">&#x27;null&#x27;</span>) <span class="hljs-operator">|</span> json_quote(<span class="hljs-string">&#x27;&quot;null&quot;&#x27;</span>) <span class="hljs-operator">|</span> json_quote(<span class="hljs-string">&#x27;[1, 2, 3]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+----------------------+-------------------------+</span><br><span class="hljs-operator">|</span> &quot;null&quot;             <span class="hljs-operator">|</span> &quot;\&quot;<span class="hljs-keyword">null</span>\&quot;&quot;           <span class="hljs-operator">|</span> &quot;[1, 2, 3]&quot;             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+----------------------+-------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>除此之外，也可通过 CAST(value AS JSON) 进行类型转换。</li>
</ul>
<h4 id="JSON-UNQUOTE-json-val">JSON_UNQUOTE(json_val)</h4>
<ul>
<li>将 JSON 转义成字符串输出。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>,json_unquote(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>),<br>    <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> json_valid(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>),json_valid(json_unquote(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>)) <span class="hljs-keyword">from</span> t;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------------------------+---------------------------+-----------------------------------------+</span><br><span class="hljs-operator">|</span> c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span> <span class="hljs-operator">|</span> json_unquote(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>) <span class="hljs-operator">|</span> json_valid(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>) <span class="hljs-operator">|</span> json_valid(json_unquote(c2<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;$.ename&#x27;</span>)) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------------------------+---------------------------+-----------------------------------------+</span><br><span class="hljs-operator">|</span> &quot;jack&quot;        <span class="hljs-operator">|</span> jack                        <span class="hljs-operator">|</span>                         <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                                       <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span> &quot;mark&quot;        <span class="hljs-operator">|</span> mark                        <span class="hljs-operator">|</span>                         <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                                       <span class="hljs-number">0</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+-----------------------------+---------------------------+-----------------------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<ul>
<li>直观地看，没加 JSON_UNQUOTE 字符串会用双引号引起来，加了 JSON_UNQUOTE 就没有。但本质上，前者是 JSON 中的 STRING 类型，后者是 MySQL 中的字符类型，这一点可通过 JSON_VALID 来判断。</li>
</ul>
<h4 id="JSON-OBJECTAGG-key-value">JSON_OBJECTAGG(key, value)</h4>
<ul>
<li>取表中的两列作为参数，其中，第一列是 key，第二列是 value，返回 JSON 对象。如，</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs lua">mysql&gt; <span class="hljs-built_in">select</span> * from emp;<br>+<span class="hljs-comment">--------+----------+--------+</span><br>| deptno | ename    | sal    |<br>+<span class="hljs-comment">--------+----------+--------+</span><br>|     <span class="hljs-number">10</span> | emp_1001 | <span class="hljs-number">100.00</span> |<br>|     <span class="hljs-number">10</span> | emp_1002 | <span class="hljs-number">200.00</span> |<br>|     <span class="hljs-number">20</span> | emp_1003 | <span class="hljs-number">300.00</span> |<br>|     <span class="hljs-number">20</span> | emp_1004 | <span class="hljs-number">400.00</span> |<br>+<span class="hljs-comment">--------+----------+--------+</span><br><span class="hljs-number">4</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> json_objectagg(ename,sal) from emp;<br>+<span class="hljs-comment">----------------------------------------------------------------------------------+</span><br>| json_objectagg(ename,sal)                                                        |<br>+<span class="hljs-comment">----------------------------------------------------------------------------------+</span><br>| &#123;<span class="hljs-string">&quot;emp_1001&quot;</span>: <span class="hljs-number">100.00</span>, <span class="hljs-string">&quot;emp_1002&quot;</span>: <span class="hljs-number">200.00</span>, <span class="hljs-string">&quot;emp_1003&quot;</span>: <span class="hljs-number">300.00</span>, <span class="hljs-string">&quot;emp_1004&quot;</span>: <span class="hljs-number">400.00</span>&#125; |<br>+<span class="hljs-comment">----------------------------------------------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-built_in">select</span> deptno,json_objectagg(ename,sal) from emp group by deptno;<br>+<span class="hljs-comment">--------+------------------------------------------+</span><br>| deptno | json_objectagg(ename,sal)                |<br>+<span class="hljs-comment">--------+------------------------------------------+</span><br>|     <span class="hljs-number">10</span> | &#123;<span class="hljs-string">&quot;emp_1001&quot;</span>: <span class="hljs-number">100.00</span>, <span class="hljs-string">&quot;emp_1002&quot;</span>: <span class="hljs-number">200.00</span>&#125; |<br>|     <span class="hljs-number">20</span> | &#123;<span class="hljs-string">&quot;emp_1003&quot;</span>: <span class="hljs-number">300.00</span>, <span class="hljs-string">&quot;emp_1004&quot;</span>: <span class="hljs-number">400.00</span>&#125; |<br>+<span class="hljs-comment">--------+------------------------------------------+</span><br><span class="hljs-number">2</span> rows <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-ARRAYAGG-col-or-expr">JSON_ARRAYAGG(col_or_expr)</h4>
<ul>
<li>将列的值聚合成 JSON 数组，注意，JSON 数组中元素的顺序是随机的。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-built_in">json_arrayagg</span>(ename) <span class="hljs-keyword">from</span> emp;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-built_in">json_arrayagg</span>(ename)                             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------+</span><br><span class="hljs-operator">|</span> [&quot;emp_1001&quot;, &quot;emp_1002&quot;, &quot;emp_1003&quot;, &quot;emp_1004&quot;] <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> deptno,<span class="hljs-built_in">json_arrayagg</span>(ename) <span class="hljs-keyword">from</span> emp <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptno;<br><span class="hljs-operator">+</span><span class="hljs-comment">--------+--------------------------+</span><br><span class="hljs-operator">|</span> deptno <span class="hljs-operator">|</span> <span class="hljs-built_in">json_arrayagg</span>(ename)     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+--------------------------+</span><br><span class="hljs-operator">|</span>     <span class="hljs-number">10</span> <span class="hljs-operator">|</span> [&quot;emp_1001&quot;, &quot;emp_1002&quot;] <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>     <span class="hljs-number">20</span> <span class="hljs-operator">|</span> [&quot;emp_1003&quot;, &quot;emp_1004&quot;] <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------+--------------------------+</span><br><span class="hljs-number">2</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-PRETTY-json-val">JSON_PRETTY(json_val)</h4>
<ul>
<li>将 JSON 格式化输出。</li>
</ul>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">mysql</span>&gt; select json_pretty(<span class="hljs-string">&quot;[1,3,5]&quot;</span>);<br>+<span class="hljs-comment">------------------------+</span><br>| json_pretty(<span class="hljs-string">&quot;[1,3,5]&quot;</span>) |<br>+<span class="hljs-comment">------------------------+</span><br>| [<br>  <span class="hljs-number">1</span>,<br>  <span class="hljs-number">3</span>,<br>  <span class="hljs-number">5</span><br>]      |<br>+<span class="hljs-comment">------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br><br><span class="hljs-title">mysql</span>&gt; select json_pretty(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>:<span class="hljs-string">&quot;10&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>:<span class="hljs-string">&quot;15&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>:<span class="hljs-string">&quot;25&quot;</span>&#125;&#x27;);<br>+<span class="hljs-comment">---------------------------------------------+</span><br>| json_pretty(&#x27;&#123;<span class="hljs-string">&quot;a&quot;</span>:<span class="hljs-string">&quot;10&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>:<span class="hljs-string">&quot;15&quot;</span>,<span class="hljs-string">&quot;x&quot;</span>:<span class="hljs-string">&quot;25&quot;</span>&#125;&#x27;) |<br>+<span class="hljs-comment">---------------------------------------------+</span><br>| &#123;<br>  <span class="hljs-string">&quot;a&quot;</span>: <span class="hljs-string">&quot;10&quot;</span>,<br>  <span class="hljs-string">&quot;b&quot;</span>: <span class="hljs-string">&quot;15&quot;</span>,<br>  <span class="hljs-string">&quot;x&quot;</span>: <span class="hljs-string">&quot;25&quot;</span><br>&#125;   |<br>+<span class="hljs-comment">---------------------------------------------+</span><br><span class="hljs-number">1</span> row <span class="hljs-keyword">in</span> set (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-STORAGE-FREE-json-val">JSON_STORAGE_FREE(json_val)</h4>
<ul>
<li>MySQL 8.0 新增的，与 Partial Updates 有关，用于计算 JSON 文档在进行部分更新后的剩余空间。</li>
</ul>
<h4 id="JSON-STORAGE-SIZE-json-val">JSON_STORAGE_SIZE(json_val)</h4>
<ul>
<li>MySQL 5.7.22 引入的，用于计算 JSON 文档的空间使用情况。</li>
</ul>
<h4 id="JSON-DEPTH-json-doc">JSON_DEPTH(json_doc)</h4>
<ul>
<li>返回 JSON 文档的最大深度。对于空数组，空对象，标量值，其深度为 1。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_depth(<span class="hljs-string">&#x27;&#123;&#125;&#x27;</span>),json_depth(<span class="hljs-string">&#x27;[10, 20]&#x27;</span>),json_depth(<span class="hljs-string">&#x27;[10, &#123;&quot;a&quot;: 20&#125;]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+------------------------+-------------------------------+</span><br><span class="hljs-operator">|</span> json_depth(<span class="hljs-string">&#x27;&#123;&#125;&#x27;</span>) <span class="hljs-operator">|</span> json_depth(<span class="hljs-string">&#x27;[10, 20]&#x27;</span>) <span class="hljs-operator">|</span> json_depth(<span class="hljs-string">&#x27;[10, &#123;&quot;a&quot;: 20&#125;]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+------------------------+-------------------------------+</span><br><span class="hljs-operator">|</span>                <span class="hljs-number">1</span> <span class="hljs-operator">|</span>                      <span class="hljs-number">2</span> <span class="hljs-operator">|</span>                             <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+------------------------+-------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-LENGTH-json-doc-path">JSON_LENGTH(json_doc[, path])</h4>
<ul>
<li>返回 JSON 文档的长度，其计算规则如下：
<ol>
<li>如果是标量值，其长度为 1。</li>
<li>如果是数组，其长度为数组元素的个数。</li>
<li>如果是对象，其长度为对象元素的个数。</li>
<li>不包括嵌套数据和嵌套对象的长度。</li>
</ol>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_length(<span class="hljs-string">&#x27;&quot;abc&quot;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+</span><br><span class="hljs-operator">|</span> json_length(<span class="hljs-string">&#x27;&quot;abc&quot;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+</span><br><span class="hljs-operator">|</span>                    <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_length(<span class="hljs-string">&#x27;[1, 2, &#123;&quot;a&quot;: 3&#125;]&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+</span><br><span class="hljs-operator">|</span> json_length(<span class="hljs-string">&#x27;[1, 2, &#123;&quot;a&quot;: 3&#125;]&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+</span><br><span class="hljs-operator">|</span>                               <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_length(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------+</span><br><span class="hljs-operator">|</span> json_length(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------+</span><br><span class="hljs-operator">|</span>                                       <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_length(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_length(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: 1, &quot;b&quot;: &#123;&quot;c&quot;: 30&#125;&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-operator">|</span>                                              <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-TYPE-json-val">JSON_TYPE(json_val)</h4>
<ul>
<li>返回 JSON 值的类型。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_type(<span class="hljs-string">&#x27;123&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> json_type(<span class="hljs-string">&#x27;123&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-type">INTEGER</span>          <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_type(<span class="hljs-string">&#x27;&quot;abc&quot;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> json_type(<span class="hljs-string">&#x27;&quot;abc&quot;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-operator">|</span> STRING             <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_type(<span class="hljs-built_in">cast</span>(now() <span class="hljs-keyword">as</span> json));<br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+</span><br><span class="hljs-operator">|</span> json_type(<span class="hljs-built_in">cast</span>(now() <span class="hljs-keyword">as</span> json)) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+</span><br><span class="hljs-operator">|</span> DATETIME                       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">--------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br><br>mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_type(json_extract(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: [10, true]&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>));<br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span><br><span class="hljs-operator">|</span> json_type(json_extract(<span class="hljs-string">&#x27;&#123;&quot;a&quot;: [10, true]&#125;&#x27;</span>, <span class="hljs-string">&#x27;$.a&#x27;</span>)) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span><br><span class="hljs-operator">|</span> <span class="hljs-keyword">ARRAY</span>                                               <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">-----------------------------------------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-VALID-val">JSON_VALID(val)</h4>
<ul>
<li>判断给定值是否是有效的 JSON 文档。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> json_valid(<span class="hljs-string">&#x27;hello&#x27;</span>), json_valid(<span class="hljs-string">&#x27;&quot;hello&quot;&#x27;</span>);<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+-----------------------+</span><br><span class="hljs-operator">|</span> json_valid(<span class="hljs-string">&#x27;hello&#x27;</span>) <span class="hljs-operator">|</span> json_valid(<span class="hljs-string">&#x27;&quot;hello&quot;&#x27;</span>) <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+-----------------------+</span><br><span class="hljs-operator">|</span>                   <span class="hljs-number">0</span> <span class="hljs-operator">|</span>                     <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+-----------------------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-TABLE-expr-path-COLUMNS-column-list-AS-alias">JSON_TABLE(expr, path COLUMNS (column_list) [AS] alias)</h4>
<ul>
<li>从 JSON 文档中提取数据并以表格的形式返回。</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">JSON_TABLE</span>(<br>    expr,<br>    path COLUMNS (column_list)<br>)   <span class="hljs-selector-attr">[AS]</span> <span class="hljs-selector-tag">alias</span><br><br><span class="hljs-selector-tag">column_list</span>:<br>    <span class="hljs-selector-tag">column</span><span class="hljs-selector-attr">[, column]</span><span class="hljs-selector-attr">[, ...]</span><br><br><span class="hljs-selector-tag">column</span>:<br>    <span class="hljs-selector-tag">name</span> <span class="hljs-selector-tag">FOR</span> <span class="hljs-selector-tag">ORDINALITY</span><br>    |  <span class="hljs-selector-tag">name</span> <span class="hljs-selector-tag">type</span> <span class="hljs-selector-tag">PATH</span> <span class="hljs-selector-tag">string_path</span> <span class="hljs-selector-attr">[on_empty]</span> <span class="hljs-selector-attr">[on_error]</span><br>    |  <span class="hljs-selector-tag">name</span> <span class="hljs-selector-tag">type</span> <span class="hljs-selector-tag">EXISTS</span> <span class="hljs-selector-tag">PATH</span> <span class="hljs-selector-tag">string_path</span><br>    |  <span class="hljs-selector-tag">NESTED</span> <span class="hljs-selector-attr">[PATH]</span> <span class="hljs-selector-tag">path</span> <span class="hljs-selector-tag">COLUMNS</span> (column_list)<br><br><span class="hljs-selector-tag">on_empty</span>:<br>    &#123;<span class="hljs-selector-tag">NULL</span> | <span class="hljs-selector-tag">DEFAULT</span> <span class="hljs-selector-tag">json_string</span> | <span class="hljs-selector-tag">ERROR</span>&#125; <span class="hljs-selector-tag">ON</span> <span class="hljs-selector-tag">EMPTY</span><br><br><span class="hljs-selector-tag">on_error</span>:<br>    &#123;<span class="hljs-selector-tag">NULL</span> | <span class="hljs-selector-tag">DEFAULT</span> <span class="hljs-selector-tag">json_string</span> | <span class="hljs-selector-tag">ERROR</span>&#125; <span class="hljs-selector-tag">ON</span> <span class="hljs-selector-tag">ERROR</span><br></code></pre></td></tr></table></figure>
<ul>
<li>
<p>expr：可以返回 JSON 文档的表达式。可以是一个标量（ JSON 文档 ），列名或者一个函数调用（ JSON_EXTRACT(t1.json_data,‘$.post.comments’) ）。</p>
</li>
<li>
<p>path：JSON 的路径表达式，</p>
</li>
<li>
<p>column：列的类型，支持以下四种类型：</p>
</li>
<li>
<ul>
<li>name FOR ORDINALITY：序号。name 是列名。
<ul>
<li>name type PATH string_path [on_empty] [on_error]：提取指定路径（ string_path ）的元素。name 是列名，type 是 MySQL 中的数据类型。</li>
<li>name type EXISTS PATH string_path：指定路径（ string_path ）的元素是否存在。</li>
<li>NESTED [PATH] path COLUMNS (column_list)：将嵌套对象或数组与来自父对象或数组的 JSON 值扁平化为一行输出。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span><br> <span class="hljs-keyword">from</span><br>   <span class="hljs-built_in">json_table</span>(<br>     <span class="hljs-string">&#x27;[&#123;&quot;x&quot;:2, &quot;y&quot;:&quot;8&quot;, &quot;z&quot;:9, &quot;b&quot;:[1,2,3]&#125;, &#123;&quot;x&quot;:&quot;3&quot;, &quot;y&quot;:&quot;7&quot;&#125;, &#123;&quot;x&quot;:&quot;4&quot;, &quot;y&quot;:6, &quot;z&quot;:10&#125;]&#x27;</span>,<br>     &quot;$[*]&quot; columns(<br>       id <span class="hljs-keyword">for</span> ordinality,<br>       xval <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) path &quot;$.x&quot;,<br>       yval <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) path &quot;$.y&quot;,<br>       z_exist <span class="hljs-type">int</span> <span class="hljs-keyword">exists</span> path &quot;$.z&quot;,<br>       nested path <span class="hljs-string">&#x27;$.b[*]&#x27;</span> columns (b <span class="hljs-type">INT</span> PATH <span class="hljs-string">&#x27;$&#x27;</span>)<br>     )<br>   ) <span class="hljs-keyword">as</span> t;<br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+------+---------+------+</span><br><span class="hljs-operator">|</span> id   <span class="hljs-operator">|</span> xval <span class="hljs-operator">|</span> yval <span class="hljs-operator">|</span> z_exist <span class="hljs-operator">|</span> b    <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+------+---------+------+</span><br><span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>    <span class="hljs-operator">|</span> <span class="hljs-number">8</span>    <span class="hljs-operator">|</span>       <span class="hljs-number">1</span> <span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>    <span class="hljs-operator">|</span> <span class="hljs-number">8</span>    <span class="hljs-operator">|</span>       <span class="hljs-number">1</span> <span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>    <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-number">2</span>    <span class="hljs-operator">|</span> <span class="hljs-number">8</span>    <span class="hljs-operator">|</span>       <span class="hljs-number">1</span> <span class="hljs-operator">|</span>    <span class="hljs-number">3</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>    <span class="hljs-number">2</span> <span class="hljs-operator">|</span> <span class="hljs-number">3</span>    <span class="hljs-operator">|</span> <span class="hljs-number">7</span>    <span class="hljs-operator">|</span>       <span class="hljs-number">0</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">|</span>    <span class="hljs-number">3</span> <span class="hljs-operator">|</span> <span class="hljs-number">4</span>    <span class="hljs-operator">|</span> <span class="hljs-number">6</span>    <span class="hljs-operator">|</span>       <span class="hljs-number">1</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------+------+------+---------+------+</span><br><span class="hljs-number">5</span> <span class="hljs-keyword">rows</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>
<h4 id="JSON-SCHEMA-VALID-schema-document">JSON_SCHEMA_VALID(schema,document)</h4>
<ul>
<li>判断 document （ JSON 文档 ）是否满足 schema （ JSON 对象）定义的规范要求。完整的规范要求可参考 <a target="_blank" rel="noopener" href="https://json-schema.org/specification-links.html#draft-4">Draft 4 of the JSON Schema specification</a> 。如果不满足，可通过 JSON_SCHEMA_VALIDATION_REPORT() 获取具体的原因。</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">set</span> <span class="hljs-meta">@schema</span> <span class="hljs-operator">=</span> &#x27;&#123;<br>   <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;object&quot;</span>,<br>   <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>     <span class="hljs-string">&quot;latitude&quot;</span>: &#123;<br>       <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;number&quot;</span>,<br>       <span class="hljs-string">&quot;minimum&quot;</span>: <span class="hljs-operator">-</span><span class="hljs-number">90</span>,<br>       <span class="hljs-string">&quot;maximum&quot;</span>: <span class="hljs-number">90</span><br>     &#125;,<br>     <span class="hljs-string">&quot;longitude&quot;</span>: &#123;<br>       <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;number&quot;</span>,<br>       <span class="hljs-string">&quot;minimum&quot;</span>: <span class="hljs-operator">-</span><span class="hljs-number">180</span>,<br>       <span class="hljs-string">&quot;maximum&quot;</span>: <span class="hljs-number">180</span><br>     &#125;<br>   &#125;,<br>   <span class="hljs-string">&quot;required&quot;</span>: [<span class="hljs-string">&quot;latitude&quot;</span>, <span class="hljs-string">&quot;longitude&quot;</span>]<br>&#125;&#x27;;<br></code></pre></td></tr></table></figure>
<ul>
<li>它的要求如下：
<ol>
<li>document 必须是 JSON 对象。</li>
<li>JSON 对象必需的两个属性是 latitude 和 longitude。</li>
<li>latitude 和 longitude 必须是数值类型，且两者的大小分别在 -90 ～ 90，-180 ～ 180 之间。</li>
</ol>
</li>
<li>下面通过具体的 document 来测试一下。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java">mysql&gt; set <span class="hljs-meta">@document</span> = <span class="hljs-string">&#x27;&#123;&quot;latitude&quot;: 63.444697,&quot;longitude&quot;: 10.445118&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_schema_valid</span><span class="hljs-params">(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span></span>;<br>+---------------------------------------+<br>| json_schema_valid(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>) |<br>+---------------------------------------+<br>|                                     <span class="hljs-number">1</span> |<br>+---------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; set @document </span>= <span class="hljs-string">&#x27;&#123;&quot;latitude&quot;: 63.444697&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_schema_valid</span><span class="hljs-params">(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span></span>;<br>+---------------------------------------+<br>| json_schema_valid(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>) |<br>+---------------------------------------+<br>|                                     <span class="hljs-number">0</span> |<br>+---------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_pretty</span><span class="hljs-params">(json_schema_validation_report(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span>)\G</span><br><span class="hljs-function">*************************** 1. row ***************************</span><br><span class="hljs-function"><span class="hljs-title">json_pretty</span><span class="hljs-params">(json_schema_validation_report(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span>): </span>&#123;<br>  <span class="hljs-string">&quot;valid&quot;</span>: <span class="hljs-keyword">false</span>,<br>  <span class="hljs-string">&quot;reason&quot;</span>: <span class="hljs-string">&quot;The JSON document location &#x27;#&#x27; failed requirement &#x27;required&#x27; at JSON Schema location &#x27;#&#x27;&quot;</span>,<br>  <span class="hljs-string">&quot;schema-location&quot;</span>: <span class="hljs-string">&quot;#&quot;</span>,<br>  <span class="hljs-string">&quot;document-location&quot;</span>: <span class="hljs-string">&quot;#&quot;</span>,<br>  <span class="hljs-string">&quot;schema-failed-keyword&quot;</span>: <span class="hljs-string">&quot;required&quot;</span><br>&#125;<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; set @document </span>= <span class="hljs-string">&#x27;&#123;&quot;latitude&quot;: 91,&quot;longitude&quot;: 0&#125;&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-function">rows <span class="hljs-title">affected</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_schema_valid</span><span class="hljs-params">(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span></span>;<br>+---------------------------------------+<br>| json_schema_valid(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>) |<br>+---------------------------------------+<br>|                                     <span class="hljs-number">0</span> |<br>+---------------------------------------+<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">mysql&gt; select <span class="hljs-title">json_pretty</span><span class="hljs-params">(json_schema_validation_report(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span>)\G</span><br><span class="hljs-function">*************************** 1. row ***************************</span><br><span class="hljs-function"><span class="hljs-title">json_pretty</span><span class="hljs-params">(json_schema_validation_report(<span class="hljs-meta">@schema</span>, <span class="hljs-meta">@document</span>)</span>): </span>&#123;<br>  <span class="hljs-string">&quot;valid&quot;</span>: <span class="hljs-keyword">false</span>,<br>  <span class="hljs-string">&quot;reason&quot;</span>: <span class="hljs-string">&quot;The JSON document location &#x27;#/latitude&#x27; failed requirement &#x27;maximum&#x27; at JSON Schema location &#x27;#/properties/latitude&#x27;&quot;</span>,<br>  <span class="hljs-string">&quot;schema-location&quot;</span>: <span class="hljs-string">&quot;#/properties/latitude&quot;</span>,<br>  <span class="hljs-string">&quot;document-location&quot;</span>: <span class="hljs-string">&quot;#/latitude&quot;</span>,<br>  <span class="hljs-string">&quot;schema-failed-keyword&quot;</span>: <span class="hljs-string">&quot;maximum&quot;</span><br>&#125;<br><span class="hljs-number">1</span> <span class="hljs-function">row in <span class="hljs-title">set</span> <span class="hljs-params">(<span class="hljs-number">0.00</span> sec)</span></span><br></code></pre></td></tr></table></figure>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Software/">Software</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/BackEnd/">BackEnd</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/BackEnd/Database/">Database</a>
                    
                      <a class="hover-with-bg" href="/categories/Software/BackEnd/Database/MySQL/">MySQL</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/Software/DesignPattern/%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">设计模式适配器模式</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/Software/DesignPattern/%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/">
                        <span class="hidden-mobile">设计模式建造者模式</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                

              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
    
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/events.js" ></script>
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/local-search.js" ></script>



  
    <script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({"theme":"default"});
    }
  </script>







<!-- 主题的启动项 保持在最底部 -->
<script  src="https://cdn.jsdelivr.net/gh/LuShan123888/SoftwareMagic@gh-pages/js/boot.js" ></script>


</body>
</html>
